<?php


require_once("AntiMeridian.php");

try {

    // Example GeoJSON MultiPolygon
    $geojson = [
        'type' => 'Feature',
        'geometry' => [
            "type" => "MultiPolygon",
            "coordinates" => [
                [
                    [[0, 0], [10, 0], [10, 10], [0, 10], [0, 0]], // First polygon
                ],
                [
                    [[-10, -10], [-5, -10], [-5, -5], [-10, -5], [-10, -10]], // Second polygon
                ]
            ]
        ]
    ];

    $geojsonS5 = [
        'type' => 'Feature',
        'properties' => [],
        'geometry' => [
            'type' => 'Polygon', 
            'coordinates'=> [
                [
                    [ -56.1922950,  53.5909730], 
                    [ -54.1918070,  55.1427400], 
                    [ -52.0226300,  56.6554100], 
                    [ -49.6661380,  58.1234550], 
                    [ -47.1019200,  59.5404240], 
                    [ -44.3087430,  60.8987350], 
                    [ -41.2659260,  62.1902240], 
                    [ -37.9514050,  63.4047800], 
                    [ -34.3478240,  64.5318300], 
                    [ -30.4416640,  65.5591660], 
                    [ -26.2261900,  66.4734950], 
                    [ -21.7077220,  67.2615900], 
                    [ -16.9058110,  67.9096600], 
                    [ -11.8584610,  68.4052900], 
                    [  -6.6206280,  68.7379800], 
                    [  -1.2637311,  68.8997400], 
                    [   4.1296535,  68.8868800], 
                    [   9.4738180,  68.6995700], 
                    [  14.6873660,  68.3424800], 
                    [  19.7013740,  67.8236850], 
                    [  24.4630500,  67.1545000], 
                    [  28.9372900,  66.3471100], 
                    [  33.1068840,  65.4155960], 
                    [  36.9680000,  64.3732500], 
                    [  40.5275570,  63.2330600], 
                    [  43.8003650,  62.0069300], 
                    [  46.8054580,  60.7056920], 
                    [  49.5631300,  59.3386570], 
                    [  52.0956760,  57.9144400], 
                    [  54.4237600,  56.4401660], 
                    [  56.5675620,  54.9222600], 
                    [  58.5453070,  53.3658640], 
                    [  60.3738000,  51.7759060], 
                    [  62.0682100,  50.1562160], 
                    [  63.6419940,  48.5102540], 
                    [  65.1071850,  46.8410030], 
                    [  66.4752350,  45.1513560], 
                    [  67.7547800,  43.4431570], 
                    [  68.9545700,  41.7184500], 
                    [  70.0821600,  39.9789470], 
                    [  71.1442640,  38.2262200], 
                    [  72.1467700,  36.4616700], 
                    [  73.0946400,  34.6861100], 
                    [  73.9928300,  32.9007300], 
                    [  74.8456500,  31.1067370], 
                    [  75.6564400,  29.3045650], 
                    [  76.4287950,  27.4950870], 
                    [  77.1656800,  25.6790390], 
                    [  77.8697000,  23.8569180], 
                    [  78.5431400,  22.0292030], 
                    [  79.1884300,  20.1965560], 
                    [  79.8074700,  18.3594590], 
                    [  80.4018200,  16.5181000], 
                    [  80.9731750,  14.6729630], 
                    [  81.5231900,  12.8245930], 
                    [  82.0527500,  10.9729960], 
                    [  82.5634300,   9.1187610], 
                    [  83.0560900,   7.2620287], 
                    [  83.5316540,   5.4031250], 
                    [  83.9910200,   3.5422018], 
                    [  84.4350100,   1.6796422], 
                    [  84.8643340,  -0.1844159], 
                    [  85.2795800,  -2.0496845], 
                    [  85.6812500,  -3.9160523], 
                    [  86.0699900,  -5.7832017], 
                    [  86.4461700,  -7.6510277], 
                    [  86.8100500,  -9.5193820], 
                    [  87.1622700, -11.3879880], 
                    [  87.5026800, -13.2568150], 
                    [  87.8316650, -15.1256430], 
                    [  88.1495900, -16.9942280], 
                    [  88.4561900, -18.8626200], 
                    [  88.7517400, -20.7305770], 
                    [  89.0361700, -22.5979270], 
                    [  89.3095400, -24.4646590], 
                    [  89.5713650, -26.3305990], 
                    [  89.8217600, -28.1956560], 
                    [  90.0603900, -30.0596310], 
                    [  90.2867800, -31.9225440], 
                    [  90.5001900, -33.7842830], 
                    [  90.7006600, -35.6446500], 
                    [  90.8867600, -37.5036740], 
                    [  91.0586700, -39.3611200], 
                    [  91.2143100, -41.2171200], 
                    [  91.3531300, -43.0713400], 
                    [  91.4731000, -44.9238430], 
                    [  91.5730900, -46.7744560], 
                    [  91.6503200, -48.6231600], 
                    [  91.7029650, -50.4697270], 
                    [  91.7274860, -52.3141980], 
                    [  91.7201700, -54.1563500], 
                    [  91.6771400, -55.9959900], 
                    [  91.5920700, -57.8329120], 
                    [  91.4582000, -59.6670300], 
                    [  91.2669700, -61.4979320], 
                    [  91.0069000, -63.3252700], 
                    [  90.6639900, -65.1485100], 
                    [  90.2185600, -66.9671700], 
                    [  89.6463500, -68.7802300], 
                    [  88.9113900, -70.5865500], 
                    [  87.9666100, -72.3843840], 
                    [  86.7414900, -74.1713300], 
                    [  85.1324900, -75.9436400], 
                    [  82.9810100, -77.6953300], 
                    [  80.0279900, -79.4167250], 
                    [  75.8415100, -81.0908200], 
                    [  69.6492540, -82.6854200], 
                    [  60.0685120, -84.1360900], 
                    [  44.8626900, -85.3077200], 
                    [  41.6165120, -85.4600800], 
                    [  44.6215360, -85.7326500], 
                    [  79.8345700, -87.0896100], 
                    [ 122.8751300, -86.7606050], 
                    [ 139.1886000, -85.9911400], 
                    [ 150.5562400, -84.9400560], 
                    [ 155.6530300, -84.2117500], 
                    [ 160.3266000, -83.3234000], 
                    [ 162.9363600, -82.7068600], 
                    [ 165.7203500, -81.9316200], 
                    [ 167.4692500, -81.3732000], 
                    [ 169.5095000, -80.6432800], 
                    [ 170.8918300, -80.0964500], 
                    [ 172.6115000, -79.3527100], 
                    [ 173.8473500, -78.7723100], 
                    [ 175.4710800, -77.9479450], 
                    [ 176.7008700, -77.2738950], 
                    [ 178.4008800, -76.2641600], 
                    [ 179.7544400, -75.3864000], 
                    [-178.2763800, -73.9663240], 
                    [-176.6203500, -72.6050700], 
                    [-174.0369700, -70.0530400], 
                    [-173.0306900, -68.8665000], 
                    [-173.0306900, -68.8665000], 
                    [-178.2936400, -68.5645200], 
                    [ 176.6216700, -68.0989800], 
                    [ 171.7739400, -67.4797500], 
                    [ 167.2030000, -66.7194300], 
                    [ 162.9322700, -65.8308900], 
                    [ 158.9693000, -64.8278800], 
                    [ 155.3103500, -63.7233470], 
                    [ 151.9431300, -62.5294840], 
                    [ 148.8496100, -61.2573620], 
                    [ 146.0095800, -59.9168930], 
                    [ 143.4017500, -58.5166700], 
                    [ 141.0044100, -57.0642900], 
                    [ 138.7977100, -55.5662570], 
                    [ 136.7627900, -54.0282670], 
                    [ 134.8822300, -52.4551000], 
                    [ 133.1403800, -50.8509750], 
                    [ 131.5229800, -49.2196120], 
                    [ 130.0179700, -47.5639760], 
                    [ 128.6137000, -45.8867870], 
                    [ 127.3007000, -44.1904600], 
                    [ 126.0696640, -42.4768640], 
                    [ 124.9134750, -40.7479130], 
                    [ 123.8248700, -39.0050960], 
                    [ 122.7974800, -37.2498440], 
                    [ 121.8261600, -35.4832800], 
                    [ 120.9060800, -33.7064500], 
                    [ 120.0326460, -31.9204440], 
                    [ 119.2020100, -30.1260300], 
                    [ 118.4109800, -28.3239440], 
                    [ 117.6563640, -26.5148330], 
                    [ 116.9351600, -24.6993940], 
                    [ 116.2450700, -22.8781800], 
                    [ 115.5837860, -21.0516760], 
                    [ 114.9493260, -19.2203400], 
                    [ 114.3397750, -17.3846020], 
                    [ 113.7535400, -15.5448520], 
                    [ 113.1890700, -13.7014930], 
                    [ 112.6450700, -11.8548070], 
                    [ 112.1201600, -10.0051880], 
                    [ 111.6134950,  -8.1528010], 
                    [ 111.1238400,  -6.2980150], 
                    [ 110.6502000,  -4.4410880], 
                    [ 110.1920200,  -2.5822449], 
                    [ 109.7483500,  -0.7217003], 
                    [ 109.3187400,   1.1404055], 
                    [ 108.9022500,   3.0037248], 
                    [ 108.4985900,   4.8681264], 
                    [ 108.1072000,   6.7334810], 
                    [ 107.7275700,   8.5995655], 
                    [ 107.3594360,  10.4662640], 
                    [ 107.0025250,  12.3333650], 
                    [ 106.6562900,  14.2007475], 
                    [ 106.3207860,  16.0682740], 
                    [ 105.9959100,  17.9357870], 
                    [ 105.6810000,  19.8032600], 
                    [ 105.3765200,  21.6705110], 
                    [ 105.0822600,  23.5373330], 
                    [ 104.7980100,  25.4037670], 
                    [ 104.5246050,  27.2696150], 
                    [ 104.2615050,  29.1349850], 
                    [ 104.0090100,  30.9995400], 
                    [ 103.7677300,  32.8632900], 
                    [ 103.5379400,  34.7261660], 
                    [ 103.3200200,  36.5881270], 
                    [ 103.1147500,  38.4490800], 
                    [ 102.9228740,  40.3089200], 
                    [ 102.7453160,  42.1676560], 
                    [ 102.5827300,  44.0251600], 
                    [ 102.4371800,  45.8814000], 
                    [ 102.3098700,  47.7363360], 
                    [ 102.2023700,  49.5899050], 
                    [ 102.1175000,  51.4419100], 
                    [ 102.0579450,  53.2924350], 
                    [ 102.0273200,  55.1412960], 
                    [ 102.0293900,  56.9884100], 
                    [ 102.0700900,  58.8336500], 
                    [ 102.1555300,  60.6768040], 
                    [ 102.2943700,  62.5176660], 
                    [ 102.4973300,  64.3560100], 
                    [ 102.7790500,  66.1913760], 
                    [ 103.1581600,  68.0232800], 
                    [ 103.6610950,  69.8509750], 
                    [ 104.3231660,  71.6734850], 
                    [ 105.1963000,  73.4893340], 
                    [ 106.3566100,  75.2962500], 
                    [ 107.9219700,  77.0907500], 
                    [ 110.0833200,  78.8670500], 
                    [ 113.1659400,  80.6150500], 
                    [ 117.7637100,  82.3157500], 
                    [ 125.0423600,  83.9293700], 
                    [ 137.3609200,  85.3644300], 
                    [ 158.6695600,  86.4004060], 
                    [-171.0506900,  86.6447000], 
                    [-144.4548300,  85.9513600], 
                    [-128.1873300,  84.6745900], 
                    [-118.8037950,  83.1321640], 
                    [-113.0730600,  81.4666500], 
                    [-109.3359800,  79.7376100], 
                    [-106.7693700,  77.9721500], 
                    [-104.9379400,  76.1839400], 
                    [-103.5947650,  74.3805900], 
                    [-102.5909100,  72.5664800], 
                    [-101.8325040,  70.7445400], 
                    [-101.2566800,  68.9164600], 
                    [-100.8209460,  67.0835400], 
                    [-100.4946100,  65.2466350], 
                    [-100.2557600,  63.4063720], 
                    [-100.0874940,  61.5631800], 
                    [-100.0653300,  61.2558300], 
                    [ -99.4083800,  61.2076230], 
                    [ -94.7393800,  60.7733460], 
                    [ -90.5492200,  60.2530500], 
                    [ -88.2155900,  59.9159360], 
                    [ -85.7231140,  59.5255850], 
                    [ -84.1564500,  59.2677800], 
                    [ -82.3316040,  58.9587360], 
                    [ -81.1003650,  58.7463000], 
                    [ -79.5803100,  58.4807900], 
                    [ -78.5003300,  58.2903500], 
                    [ -77.1036600,  58.0421140], 
                    [ -76.0666960,  57.8564700], 
                    [ -74.6671900,  57.6041760], 
                    [ -73.5826950,  57.4073000], 
                    [ -72.0526200,  57.1272430], 
                    [ -70.8100500,  56.8973050], 
                    [ -68.9634550,  56.5495000], 
                    [ -67.3740200,  56.2416200], 
                    [ -64.8388400,  55.7263900], 
                    [ -62.4570240,  55.2052700], 
                    [ -58.1353260,  54.1355000], 
                    [ -56.1922950,  53.5909730], 
                    [ -56.1922950,  53.5909730]  
                ]
            ]
        ]
    ];
    
    $geojsons = [
        'examples/almost-180.json',
        'examples/both-poles.json',
        'examples/complex-split.json',
        'examples/crossing-latitude.json',
        'examples/cw-only.json',
        'examples/cw-split.json',
        'examples/extra-crossing.json',
        'examples/force-north-pole.json',
        'examples/great-circle.json',
        'examples/issues-124.json',
        'examples/issues-81.json',
        'examples/latitude-band.json',
        'examples/line.json',
        'examples/multi-line.json',
        'examples/multi-no-antimeridian.json',
        'examples/multi-split.json',
        'examples/north-pole.json',
        'examples/one-ccw-hole.json',
        'examples/one-hole.json',
        'examples/over-180.json',
        'examples/overlap.json',
        'examples/point-on-antimeridian.json',
        'examples/simple-with-ccw-hole.json',
        'examples/simple.json',
        'examples/south-pole.json',
        'examples/split.json',
        'examples/two-holes.json'
    ];
     
    $antimeridian = new AntiMeridian();

    for ($i = 0, $ii = count($geojsons); $i < $ii; $i++) {
        $json = file_get_contents($geojsons[$i]);
        // Check if the file was read successfully
        if ($json === false) {
            throw new Exception('Error reading file ' . $geojsons[$i]);
        }
        $fixedGeoJSON = $antimeridian->fixGeoJSON(json_decode($json, true));
        $fixedGeoJSON['properties'] = [
            'FileName'=> $geojsons[$i]
        ];
        echo json_encode($fixedGeoJSON, true) . "\n\n";
    }

} catch (Exception $e) {
    echo 'Error: ' . $e->getMessage();
}
