/*
 * mapshup - Webmapping made easy
 * http://mapshup.info
 *
 * Copyright Jérôme Gasperi, 2011.12.08
 *
 * jerome[dot]gasperi[at]gmail[dot]com
 *
 * This software is a computer program whose purpose is a webmapping application
 * to display and manipulate geographical data.
 *
 * This software is governed by the CeCILL-B license under French law and
 * abiding by the rules of distribution of free software.  You can  use,
 * modify and/ or redistribute the software under the terms of the CeCILL-B
 * license as circulated by CEA, CNRS and INRIA at the following URL
 * "http://www.cecill.info".
 *
 * As a counterpart to the access to the source code and  rights to copy,
 * modify and redistribute granted by the license, users are provided only
 * with a limited warranty  and the software's author,  the holder of the
 * economic rights,  and the successive licensors  have only  limited
 * liability.
 *
 * In this respect, the user's attention is drawn to the risks associated
 * with loading,  using,  modifying and/or developing or reproducing the
 * software by the user in light of its specific status of free software,
 * that may mean  that it is complicated to manipulate,  and  that  also
 * therefore means  that it is reserved for developers  and  experienced
 * professionals having in-depth computer knowledge. Users are therefore
 * encouraged to load and test the software's suitability as regards their
 * requirements in conditions enabling the security of their systems and/or
 * data to be ensured and,  more generally, to use and operate it in the
 * same conditions as regards security.
 *
 * The fact that you are presently reading this means that you have had
 * knowledge of the CeCILL-B license and that you accept its terms.
 */(function(c,e){c.M={VERSION_NUMBER:"mapshup 2.5",Plugins:{},load:function(a){var b=null,d=this,f=d.Util.extractKVP(c.location.href),a=a||{};void 0===d.Config&&(alert("GRAVE : no configuration file defined. Load aborted"),exit());d.Config.panels=d.Config.panels||{};$.extend(d.Config.panels,{south:d.Config.panels.south||{},side:d.Config.panels.side||{}});if(c.location.hash){var e,h,j=c.location.hash.split(":");try{e=d.Map.Util.Geohash.decode(j[0]),f.lon=e.lon,f.lat=e.lat,h=parseInt(j[1]),f.zoom=!isNaN(h)?
h:9}catch(k){}}0===$("#mapshup").length&&(alert('GRAVE : no <div id="mapshup"> defined. Load aborted'),exit());$("#mapshup").append('<div id="wcontainer"><div id="mapcontainer"><div id="map"></div></div></div>');d.$header=d.Util.$$("#theBar",$("#mapshup")).addClass("shadow").html('<div class="container"><div class="logo hover"><a href="http://www.mapshup.info" target="_blank">mapshup</a></div><div class="searchBar"></div><div class="leftBar"></div><div class="userBar"></div></div>');d.$map=$("#map");
d.$mcontainer=$("#mapcontainer");d.$container=$("#wcontainer");d.events=new d.Events;d.tooltip=new d.Tooltip;d.activity=new d.Activity;d.mask=new d.Mask;d.TimeLine&&(d.timeLine=new d.TimeLine(d.Config.general.timeLine));d.sidePanel=new d.SidePanel({over:d.Config.panels.side.over,position:d.Config.panels.side.position,w:d.Config.panels.side.w});d.southPanel=new d.SouthPanel({over:d.Config.panels.south.over,h:d.Config.panels.south.h});if(f.uid)d.Util.ajax({url:d.Util.proxify(d.Util.getAbsoluteUrl(d.Config.general.getContextServiceUrl)+
f.uid),async:!0,dataType:"json",success:function(c){c&&c.contexts&&c.contexts[0]&&(b=JSON.parse(c.contexts[0].context));d.setLang(f,{context:b,i18n:a.i18n})},error:function(){d.Util.message("Error : context is not loaded");d.setLang(f,{i18n:a.i18n})}},{title:d.Util._("Load context"),cancel:!0});else if(f.layers)try{var m=JSON.parse(decodeURIComponent(f.layers.replace(c.location.hash,"")));$.isArray(m)||(m=[m]);i=0;for(l=m.length;i<l;i++)d.Config.add("layers",m[i]);d.setLang(f,{i18n:a.i18n})}catch(n){M.Util.message("Error : cannot read input layer"),
d.setLang(f,{i18n:a.i18n})}else d.setLang(f,{i18n:a.i18n})},setLang:function(a,b){var d,c=-1,g=-1,h=this,j=h.Config.i18n,b=b||{};a.lang&&(j.lang=a.lang);j.langs=j.langs||["en","fr"];h.i18n=[];if(!j.lang||"auto"===j.lang)try{j.lang=e.language}catch(k){j.lang=e.browserLanguage}for(d=j.langs.length;d--;)if(j.langs[d]===j.lang){c=0;break}if(-1===c){g=-1;void 0!==j.lang&&(j.lang=j.lang.substring(0,2));for(d=j.langs.length;d--;)if(j.langs[d]===j.lang){g=0;break}-1===g&&(j.lang=j.langs[0])}$.ajax({url:h.Config.general.rootUrl+
j.path+"/"+j.lang+".js",async:!0,dataType:"script",success:function(){if(b.i18n&&b.i18n[j.lang])for(var d in b.i18n[j.lang])M.i18n[d]=b.i18n[j.lang][d];h.init(a,b.context)},error:function(){$.ajax({url:h.Config.general.rootUrl+j.path+"/en.js",async:!0,dataType:"script",success:function(){j.lang="en";h.init(a,b.context)}})}})},init:function(a,b){var d,f,e,h,j,k,m=this,n=m.Config;b&&b.location&&(n.general.location=b.location);a&&(n.general.location={bg:m.Util.getPropertyValue(a,"bg",n.general.location.bg),
lon:m.Util.getPropertyValue(a,"lon",n.general.location.lon),lat:m.Util.getPropertyValue(a,"lat",n.general.location.lat),zoom:m.Util.getPropertyValue(a,"zoom",n.general.location.zoom)});m.menu=new m.Menu;m.Map.init(n);b&&b.layers&&n.update(b.layers);m.plugins=[];d=0;for(e=n.plugins.length;d<e;d++)h=n.plugins[d].name,j=n.plugins[d].options||{},(k=(new Function("return M.Plugins."+h+" ? new M.Plugins."+h+"() : null;"))())&&k.init(j)&&(m.plugins[h]=k);d=0;for(e=n.layers.length;d<e;d++)n.layers[d].type&&
m.Map.layerTypes[n.layers[d].type]&&m.Map.addLayer(n.layers[d],{noDeletionCheck:!0,initial:!0});n.general.location.bg&&(d=m.Map.Util.getLayerByMID(n.general.location.bg))&&d.isBaseLayer&&m.Map.setBaseLayer(d);m._wd={w:c.innerWidth,h:c.innerHeight};m.$mcontainer.css({width:m.$mcontainer.width(),height:m.$mcontainer.height()});$(c).bind("resize",function(){clearTimeout(f);f=setTimeout(function(){$("#mapshup").hasClass("noResizeWidth")||m.$mcontainer.css({width:m.$mcontainer.width()+(c.innerWidth-m._wd.w)});
$("#mapshup").hasClass("noResizeHeight")||m.$mcontainer.css({height:m.$mcontainer.height()+(c.innerHeight-m._wd.h)});m._wd={w:c.innerWidth,h:c.innerHeight};m.events.trigger("resizeend")},100)});setTimeout(function(){m.events.trigger("resizeend")},1E3);$(c).bind("drop dragover",function(a){a.preventDefault();return!1})},remove:function(a){if(!a)return!1;a.$d&&a.$d.remove();this.events.unRegister(a);this.Map.events.unRegister(a);for(var b in a)a.hasOwnProperty(b)&&delete a[b];return!0}}})(window,navigator);
(function(c){c=c||{};c.Config={general:{location:{lon:0,lat:0,zoom:0}},groups:[],i18n:{},layers:[],mapOptions:{projection:new OpenLayers.Projection("EPSG:3857"),displayProjection:new OpenLayers.Projection("EPSG:4326"),numZoomLevels:22},plugins:[],upload:{},add:function(c,a){var b=this[c];$.isArray(b)&&(a&&this.get(c,"name",a.name)&&this.remove(c,a.name),b.push(a))},extend:function(c,a){var b,d,f;b=0;for(d=this.plugins.length;b<d;b++)this.plugins[b].name===c&&(f=this.plugins[b],f.options=f.options||
{},$.extend(f.options,a))},get:function(c,a,b){c=this[c];if($.isArray(c))for(var d=0,f=c.length;d<f;d++)if(c[d][a]===b)return c[d];return null},remove:function(c,a){var b,d,f,g=this[c];if(g instanceof Array&&a){f="layers"===c?"title":"name";b=0;for(d=g.length;b<d;b++)if(g[b][f]===a){g.splice(b,1);break}}},update:function(e){var a,b,d,f,g;if(!c.Map)return!1;e=e||[];for(a=0;a<this.layers.length;a++){g=!0;d=0;for(f=e.length;d<f;d++)if((new c.Map.LayerDescription(this.layers[a],c.Map)).getMID()===(new c.Map.LayerDescription(e[d],
c.Map)).getMID()){g=!1;break}g&&(this.layers.splice(a,1),a--)}a=0;for(b=e.length;a<b;a++){g=!0;d=0;for(f=this.layers.length;d<f;d++)if((new c.Map.LayerDescription(e[a],c.Map)).getMID()===(new c.Map.LayerDescription(this.layers[d],c.Map)).getMID()){g=!1;break}g?this.layers.push(e[a]):(this.layers[d].hidden=e[a].hidden,e[a].search&&(this.layers[d].search=e[a].search))}return!0}}})(window.M);
(function(c,e,a){var b=e=e||{},d;d=Math.round(865*Math.random());var f=Math.round(757*Math.random());d="&a="+d+"&b="+f+"&c="+(d+17-3*(f-2));var g,f=navigator.userAgent.toLowerCase();-1!==f.indexOf("android")?(f="android",g=!0):-1!==f.indexOf("iphone")?(f="iphone",g=!0):-1!==f.indexOf("ipod")?(f="ipod",g=!0):-1!==f.indexOf("ipad")?(f="ipad",g=!0):(f="normal",g=!1);b.Util={messages:[],abc:d,Cookie:{get:function(b){var b=b+"=",d=a.cookie.split(";"),c,f,e;c=0;for(f=d.length;c<f;c++){for(e=d[c];" "===
e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},remove:function(a){this.set(a,"",-1)},set:function(b,d,c){var f,g,p;g="";f=new Date;c?(f.setTime(f.getTime()+864E5*c),c="; expires="+f.toGMTString()):c="";p=e.Config.general.rootUrl.substr(7,e.Config.general.rootUrl.length);g=p.indexOf("/");-1===g?(f=p,g="/"):(f=p.substr(0,g),g=p.substr(g,p.length));a.cookie=b+"="+d+c+"; domain="+f+"; path="+g}},device:{type:f,touch:g},escapable:/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
meta:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},sequence:0,_:function(a){if(void 0===e.i18n)return a;var b=e.i18n[a];return"string"===typeof b?b:a},$$:function(a,b){var b=b||"body",d=$(a,b);0===d.length&&(d="."===a.substring(0,1)?"class":"id",$(b).append("<div "+d+'="'+a.substring(1,a.length)+'"></div>'),d=$(a));return d},addClose:function(a,b){var d=e.Util.getId();a.append('<span id="'+d+'" class="close" title="'+e.Util._("close")+'"></span>');$("#"+d).click(function(d){$.isFunction(b)?
b(d):a.hide()})},clone:function(a){if("object"!==typeof a||null===a)return a;var b,d=a.constructor();for(b in a)d[b]=this.clone(a[b]);return d},getCapabilities:function(a,b){var d=null;if(200!==a.status||!b)return null;try{d=b.read(e.Util.textToXML(a.responseText))}catch(c){e.Util.message(e.Util._("Error reading Capabilities file"))}return d},getHashSize:function(a){var b,d=0;for(b in a)d++;return d},getTitle:function(a){a=a||{};return a.title?a.title:(a.type||"Unknown")+"#"+this.sequence++},getUserInfo:function(){var a=
e.Plugins.LayersManager;return a&&a._o&&a._o.userInfo?a._o.userInfo:{userid:-1}},extendUrl:function(a,b){var d,c,f,e,g,r={},s="",t=a.split("?")[0];try{g=a.split("?")[1].split("&")}catch(u){g=[]}f=0;for(e=g.length;f<e;f++)d=g[f].split("=")[0],c=g[f].split("=")[1],d&&c&&(r[d]=c);b=$.extend(r,b);for(d in b)null!==b[d]&&(s+=d+"="+b[d]+"&");return t+"?"+s},showPopupImage:function(a,b){var d=new e.Popup({modal:!0,resize:!1,autoSize:!0,noHeader:!0}),f=new Image;e.activity.show();d.hide();d.$m.show();f.src=
a;$(f).load(function(){var g=[f.width,f.height,0.8*c.innerWidth,0.8*c.innerHeight],p=g[0],q=g[1];q>g[3]&&(q=g[3],p=p*q/g[1]);p>g[2]&&(p=g[2],q=q*p/g[0]);d.$b.html('<div class="imageContent"><div class="padded"><img src="'+a+'" height="'+q+'" width="'+p+'"/><div class="innerTitle" style="width:'+p+'px;">'+b+"</div></div></div>");d.$d.css({left:(c.innerWidth-d.$d.width())/2,top:0});e.activity.hide();d.show()}).error(function(){e.activity.hide();d.hide();e.Util.message("Error loading image")})},showPopupVideo:function(a){var b,
d,f,g,p=new e.Popup({modal:!0,resize:!1,autoSize:!0,noHeader:!0}),a=a||{};if(!a.url)return this.message(this._("Error : url is not defined")),!1;d=a.w||640;f=a.h||264;g=a.img||"";(b=a.type)||(b=a.url.substring(a.url.length-3,a.url.length).toLowerCase());switch(b){case "ogg":b="video/ogg";break;case "webm":b="video/webm";break;default:b="video/mp4"}p.$m.show();a='<video width="'+d+'" height="'+f+'" controls><source src="'+a.url+'" type="'+b+'" /><object width="'+d+'" height="'+f+'" type="application/x-shockwave-flash" data="http://releases.flowplayer.org/swf/flowplayer-3.2.1.swf"><param name="movie" value="http://releases.flowplayer.org/swf/flowplayer-3.2.1.swf" /><param name="allowfullscreen" value="true" /><param name="flashvars" value="controlbar=over&amp;image='+
g+"&amp;file="+a.url+'" /><img src="'+g+'" width="'+d+'" height="'+f+'" alt="'+a.title+'" title="'+a.title+'"/></object></video><p class="vjs-no-video"><a href="'+a.url+'" target="_blank">'+this._("Download Video")+"</a></p></div>";p.$b.html('<div class="imageContent"><div class="padded">'+a+"</div></div>");p.$d.css({left:(c.innerWidth-p.$d.width())/2,top:(c.innerHeight-p.$d.height())/2});p.show();return!0},stringToRealType:function(a){return!a?a:$.isNumeric(a)?parseFloat(a):"true"===a.toLowerCase()?
!0:"false"===a.toLowerCase()?!1:a},getAttributes:function(a){var b,d,c={};if(a&&a.length){a=a[0].attributes;b=0;for(d=a.length;b<d;b++)c[e.Util.stripNS(a[b].nodeName)]=e.Util.stringToRealType(a[b].nodeValue)}return c},stripNS:function(a){if(!a)return null;a=a.split(":");return 2===a.length?a[1]:a[0]},stripTags:function(b){var d=a.createElement("DIV");d.innerHTML=b;return d.textContent||d.innerText},ajax:function(a,b){var d;if("object"!==typeof a)return null;if(b){var c=this.getId();a.complete=function(){e.mask.abort(c)};
d=$.ajax(a);e.mask.add({title:b.title||this._("Processing"),cancel:!0===b.cancel?b.cancel:!1,id:c,request:d})}else d=$.ajax(a);return d},askFor:function(a){var a=a||{},b,d,c=this,f=[],g=new e.Popup({modal:!0,autoSize:!0,centered:!0,header:a.title,body:a.content?a.content:""});if("list"===a.dataType){var q,r,s=0,t;for(t in a.value)b=this.getId(),q=a.value[t],r=q.icon?'<img class="middle" src="'+q.icon+'"/>&nbsp;':"",g.append('<a href="#" class="button marged" id="'+b+'">'+r+q.title+"</a>","body"),
function(a,b,d,c){b.click(function(){$.isFunction(d)&&d(c);a.remove();return!1})}(g,$("#"+b),a.callback,q.value),s++}else"complexData"===a.dataType?(b=this.getId(),e.DDZone&&new e.DDZone({parent:g.$b,maximumMegaBytes:a.maximumMegaBytes,supportedFormats:a.supportedFormats,file:a.file,fileUrl:a.fileUrl,success:function(a){g.center();d=a;$("#"+b).show()}}),g.append('<p class="big center padded"><br/><a href="#" class="button inline validate" id="'+b+'">'+e.Util._("Set")+"</a></p>","body"),$("#"+b).click(function(){a.upload&&
d.file?c.upload(d.file,{formats:a.supportedFormats,maximumMegabytes:a.maximumMegaBytes,callback:function(b){$.isArray(b)?($.isFunction(a.callback)&&a.callback({fileUrl:b[0].url}),g.remove()):e.Util.message("Error : cannot upload file on server")}}):($.isFunction(a.callback)&&a.callback(d),g.remove())}),!a.file&&!a.fileUrl&&$("#"+b).hide()):(b=this.getId(),g.append('<input id="'+b+'" type="text" size="'+(a.size||10)+'"/>',"body"),f=$("#"+b),a.value?f.val(this.stripTags(a.value)):a.hint&&f.attr("placeholder",
a.hint),f.focus(function(){this.select()}).keypress(function(b){var d=!1,f=c.stripTags($(this).val());27===b.keyCode&&g.remove();if(13===b.keyCode||9===b.keyCode){switch(a.dataType.toLowerCase()){case "date":c.isDateOrInterval(f)||c.isISO8601(f)?d=!0:c.message(c._("Expected format is YYYY-MM-DD for a single date or YYYY-MM-DD/YYYY-MM-DD for a date interval"));break;case "bbox":c.isBBOX(f)?d=!0:c.message(c._("Expected format is lonmin,latmin,lonmax,latmax"));break;case "integer":c.isInt(f)?d=!0:c.message(c._("Error : not a valid Integer"));
break;case "float":c.isFloat(f)?d=!0:c.message(c._("Error : not a valid Float"));break;case "double":c.isFloat(f)?d=!0:c.message(c._("Error : not a valid Double"));break;case "boolean":c.isBoolean(f)?d=!0:c.message(c._("Error : not a valid Boolean"));break;default:d=!0}d&&($.isFunction(a.callback)&&a.callback(f),g.remove());return!1}}));g.show();0<f.length&&f.focus();return g},crc32:function(a,b){var d=0,d=0;b===c.undefined&&(b=0);for(var b=b^-1,f=0,e=a.length;f<e;f++)d=(b^a.charCodeAt(f))&255,d=
"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*
d,8),b=b>>>8^d;return"mid"+Math.abs(b^-1)},message:function(a,b){var d,c,f,g=this;c=g.getId();e.$container.append('<div id="'+c+'" class="message"><div class="content"></div></div>');d=$("#"+c);g.messages[c]=d;f=function(){var a,b,d=30;for(b in g.messages)a=g.messages[b],a.css({top:d}),d=a.position().top+a.height()+5};c=$(".content",d).html(a);g.addClose(c,function(){delete g.messages[d.attr("id")];d.remove();f()});b&&-1===b?(d.show(),f()):d.fadeIn("slow").delay(b||2E3).fadeOut("slow",function(){delete g.messages[d.attr("id")];
d.remove();f()});d.css({left:(e.$container.width()-d.width())/2,top:30});return d},encode:function(a){return!a?a:a.replace(/[',", ,\.,#,\:,\ ]/g,"_")},extractBaseUrl:function(a,b){var d;d=this.repareUrl(a);if(!d)return null;d=d.match(/.+\?/)[0];if(!b||0===b.length)return d;var c,f,e,g,r=this.extractKVP(a,!0);for(f in r){c=!0;e=0;for(g=b.length;e<g;e++)if(f===b[e]){c=!1;break}c&&(d+=encodeURIComponent(f)+"="+encodeURIComponent(r[f])+"&")}return d},extractKVP:function(a,b){var d={};(a||"").replace(/[?&]+([^=&]+)=([^&]*)/gi,
function(a,c,f){d[decodeURIComponent(b?c.toLowerCase():c)]=void 0===f?!0:decodeURIComponent(f)});return d},getAbsoluteUrl:function(a){return a&&e.Config.general.serverRootUrl?"object"===typeof a?a:this.isUrl(a)||"/"!==a.substr(0,1)?a:e.Config.general.serverRootUrl+a:a},getId:function(){return"mid"+this.sequence++},getImgUrl:function(a){return!a||"/"===a.substr(0,1)||"./"===a.substr(0,2)||"../"===a.substr(0,3)||"http:"===a.substr(0,5)||"https:"===a.substr(0,6)||"data:"===a.substr(0,5)?a:e.Config.general.rootUrl+
e.Config.general.themePath+"/img/"+a},getPropertyValue:function(a,b,d){return void 0===a||void 0===b?void 0:a.hasOwnProperty(b)?a[b]:d},getValidBBOX:function(a,b){if(void 0===a)return b;"string"===typeof a&&(a={bounds:a,srs:"EPSG:4326"});return a.hasOwnProperty("bounds")?a:b},isBoolean:function(a){return"boolean"===typeof a?!0:"true"===a||"false"===a?!0:!1},isInt:function(a){return!$.isNumeric(a)?!1:!(parseFloat(a)%1)},isFloat:function(a){return $.isNumeric(a)},isBBOX:function(a){if(!a||0===a.length)return!1;
a=a.split(",");if(4!==a.length)return!1;for(var b=0;3>b;b++)if(!$.isNumeric(a[b]))return!1;return parseFloat(a[0])>parseFloat(a[2])||parseFloat(a[1])>parseFloat(a[3])?!1:!0},isDate:function(a){if(!a||0===a.length)return!1;var b=[31,29,31,30,31,30,31,31,30,31,30,31],a=a.split("-");if(3!==a.length)return!1;var d=parseInt(a[0],10),c=parseInt(a[1],10),f=parseInt(a[2],10);return 4!==a[0].length||1900>d||2100<d||2!==a[1].length||1>c||12<c||2!==a[2].length||1>f||31<f||2===c&&f>(0===d%4&&(0!==d%100||0===
d%400)?29:28)||f>b[c]?!1:!0},isDateOrInterval:function(a){if(void 0===a||0===a.length)return!1;var a=a.split("/"),b=0,d,c;if(2<a.length)return!1;d=0;for(c=a.length;d<c;d++)if(!this.isDate(a[d]))if(""===a[d])b++;else return!1;return 1>a.length-b?!1:!0},isEmailAdress:function(a){return!a||0===a.length?!1:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}$/.test(a)},isSupportedMimeType:function(a,b){var a=a||[],d,c=a.length;if(0===c)return!0;for(d=0;d<c;d++)if(a[d].mimeType.toLowerCase()===b.toLowerCase())return!0;
return!1},isISO8601:function(a){if(void 0===a||0===a.length)return!1;a=a.split("/");if(2<a.length)return!1;for(var b,d=0,c=a.length;d<c;d++)if(b=a[d].split("T"),2!==b.length||!this.isDate(b[0])||!this.isTime(b[1]))return!1;return!0},isTime:function(a){if(!a||0===a.length)return!1;a.indexOf("Z")===a.length-1&&(a=a.substring(0,a.length-1));a=a.split(":");if(3!==a.length)return!1;var b=parseInt(a[0],10),d=parseInt(a[1],10),c=parseInt(a[2],10);return 2!==a[0].length||0>b||23<b||2!==a[1].length||0>d||
59<d||2!==a[2].length||0>c||59<c?!1:!0},isUrl:function(a){if(a&&"string"===typeof a){var b=a.substr(0,7);if("http://"===b||("https:/"===b||"ftp://"===b)||"//"===a.substr(0,2))return!0}return!1},paginate:function(a,b){b&&(b.nextRecord&&(a=this.repareUrl(a)+b.nextRecord.name+"="+b.nextRecord.value),b.numRecordsPerPage&&(a=this.repareUrl(a)+b.numRecordsPerPage.name+"="+b.numRecordsPerPage.value));return a},proxify:function(a,b){return e.Config.general.proxyUrl&&""!==e.Config.general.proxyUrl?this.getAbsoluteUrl(e.Config.general.proxyUrl)+
this.abc+(b?"&returntype="+b:"")+"&url="+encodeURIComponent(a):a},randomColor:function(){var a="0123456789abcdef".split(""),b="",d="",c="",f;for(f=0;2>f;f++)b+=a[Math.round(15*Math.random())],d+=a[Math.round(15*Math.random())],c+=a[Math.round(15*Math.random())];return"#"+b+d+c},parseTemplate:function(a,b,d){b=b||{};d=d||{};return"string"===typeof a?a.replace(/\$+([^\$])+\$/g,function(a){var c,a=a.replace(/[\$\$]/g,""),f=b[a];for(c in d)if(a===c){if($.isFunction(d[c].transform))return d[c].transform(f);
break}return null!=f?f:"$"+a+"$"}):a},repareUrl:function(a){if(!a)return null;var b=a.indexOf("?");return-1===b?a+"?":b===a.length-1||-1!==a.indexOf("&",a.length-1)?a:a+"&"},shorten:function(b,d,c){if(!b)return null;var f=a.createElement("textarea");f.innerHTML=b.replace(/</g,"&lt;").replace(/>/g,"&gt;");if(b=f.value){f=b.length;if(f<=d)return b;if(c)return b.substring(0,d-3)+"...";d=Math.round(d/2);return b.substring(0,d-1)+"..."+b.substring(f-d+3)}return b},findAndShorten:function(a,b){$("[class^=shorten]",
a).each(function(){var a,d,c=30,f=$(this).attr("class").split(" ");a=0;for(d=f.length;a<d;a++)0===f[a].indexOf("shorten")&&(c=parseInt(f[a].split("_")[1]));$(this).html(e.Util.shorten($(this).text(),c,b))})},sortArray:function(a,b){if("object"===typeof a&&a.length&&b){var d=this;a.sort(function(a,c){var f=d._(a[b]).toLowerCase(),e=d._(c[b]).toLowerCase();return f<e?-1:f>e?1:0})}},textToXML:function(a){try{var b,d,f=null;if(c.DOMParser)return b=new DOMParser,f=b.parseFromString(a,"text/xml"),d=f.getElementsByTagName("parsererror"),
!d||!d.length||!d[0].childNodes.length?f:null;f=new ActiveXObject("Microsoft.XMLDOM");f.async=!1;f.loadXML(a);return f}catch(e){return null}},lowerFirstLetter:function(a){return a.charAt(0).toLowerCase()+a.slice(1)},upload:function(a,b){var d,c,f,g=[],q=this,b=b||{};$.isArray(a)||(a=[a]);e.mask.add({title:this._("Upload files")+"...",cancel:!1});$(a).each(function(a,d){if(!q.isSupportedMimeType(b.formats,d.type))return q.message(e.Util._("Error : mimeType is not supported")+" ["+d.type+"]"),!1;if(d.size/
1048576>b.maximumMegabytes)return q.message(e.Util._("Error : file is to big")+" ["+d.name+"]"),!1;g.push(d);return!0});if(0<g.length){$.get("./blank.html");var r=new XMLHttpRequest;r.onreadystatechange=function(){var a;if(4===r.readyState&&(200===r.status||0===r.status))e.mask.hide(),a=JSON.parse(r.responseText),a.error?e.Util.message(a.error.message):a.items&&$.isFunction(b.callback)&&b.callback(a.items)};if("undefined"!==typeof FormData){f=new FormData;f.append("path","/");d=0;for(c=a.length;d<
c;d++)f.append("file[]",a[d]);r.open("POST",e.Util.getAbsoluteUrl(e.Config.upload.serviceUrl)+e.Util.abc+"&magic=true");r.send(f)}else e.Util.message("Error : your browser does not support HTML5 Drag and Drop")}else e.Util.message("Error : this file type is not allowed"),e.mask.hide()}}})(window,window.M,window.document);
(function(c){c.Events=function(){if(c.Events._o)return c.Events._o;this.events={resizeend:[],signin:[],signout:[]};this.register=function(c,a,b){this.events[c]&&this.events[c].push({scope:a,handler:b})};this.unRegister=function(c){var a,b,d,f;for(d in this.events){a=this.events[d];b=0;for(f=a.length;b<f;b++)if(a[b].scope===c){a.splice(b,1);break}}};this.trigger=function(c,a){var b,d=this.events[c];if(d)for(b=d.length;b--;)d[b].handler(d[b].scope,a)};c.Events._o=this;return this}})(window.M);
(function(c){c.Activity=function(){if(c.Activity._o)return c.Activity._o;this.frame=this.timer=1;this.hide=function(){this.$a.hide()};this.init=function(){this.$c=c.$container;this.$a=c.Util.$$("#activity",this.$c).css({display:"none",position:"fixed",top:"50%",left:"50%",width:"40px",height:"40px","margin-top":"-20px","margin-left":"0px",overflow:"hidden","z-index":"38500"}).html("<div></div>");this.$a.children().css({position:"absolute",top:"0",left:"0",width:"40px",height:"480px","background-image":"url('"+
c.Util.getImgUrl("activity.png")+"')"});c.events.register("resizeend",this,function(c){c.$a.css({top:c.$c.offset().top+(c.$c.height()-c.$a.height())/2,left:c.$c.offset().left+(c.$c.width()-c.$a.width())/2})})};this.show=function(){var c=this;clearInterval(this.timer);this.$a.show();this.timer=setInterval(function(){c.$a.is(":visible")?($("div",c.$a).css("top",-40*c.frame+"px"),c.frame=(c.frame+1)%12):clearInterval(c.timer)},66)};this.init();c.Activity._o=this;return this}})(window.M);
(function(c){c.Toolbar=function(e){this.items=[];this.classes=e.classes;this.orientation=c.Util.getPropertyValue(e,"orientation",null);this.parent=c.Util.getPropertyValue(e,"parent",c.$map.parent());this.position=c.Util.getPropertyValue(e,"position",null);this.init=function(a){var b="tb",d="_o"+(this.position?this.position:c.Util.getId())+"tb";if(c.Toolbar[d])return c.Toolbar[d];c.Toolbar[d]=this;this.$d=c.Util.$$("#"+c.Util.getId(),this.parent);this.position&&this.$d.css({position:"absolute","z-index":"19500"});
this.orientation&&(b+=" tb"+this.orientation);this.position&&(b+=" tb"+this.position+(this.orientation?this.orientation:"h"));this.$d.addClass(b+(this.classes?" "+this.classes:""));if($.isArray(a.items)){b=0;for(d=a.items.length;b<d;b++)this.add(a.items[b])}return this};this.add=function(a){a=new c.Toolbar.Item(this,a);this.items.push(a);return a};this.activate=function(a,b){var d=this.get(a);d&&d.activate(b)};this.get=function(a){for(var b=0,d=this.items.length;b<d;b++)if(this.items[b].id===a)return this.items[b];
return null};this.remove=function(a){var b,d;b=0;for(d=this.items.length;b<d;b++)if(this.items[b].id===a){this.items[b].$d.remove();this.items.splice(b,1);break}};this.clear=function(){for(var a=0,b=this.items.length;a<b;a++)this.items[a].$d.remove();this.items=[]};return this.init(e)};c.Toolbar.Item=function(e,a){a=a||{};this.onoff=a.hasOwnProperty("onoff")?a.onoff:!0;this.onactivate=a.onactivate;this.ondeactivate=a.ondeactivate;this.e=a.e||{};this.first=c.Util.getPropertyValue(a,"first",!1);this.icon=
a.icon;this.id=a.id||c.Util.getId();this.nohover=a.nohover||!1;this.tb=e;this.title=a.title;this.tt=a.tt||"";this.scope=a.scope;this.init=function(){var a,d,f=this;if(!f.tb)return null;for(a in f.e)f.e.hasOwnProperty(a)&&(f[a]=f.e[a]);delete f.e;a=c.Util.getId();d='<div class="'+(f.nohover?"":"hover ")+'item" jtitle="'+(c.Util._(f.tt)||"")+'" id="'+a+'">'+(f.title?f.title:'<img class="middle" alt="" src="'+c.Util.getImgUrl(f.icon||"empty.png")+'"/>')+"</div>";f.first?f.tb.$d.prepend(d):f.tb.$d.append(d);
f.$d=$("#"+a);f.$d.click(function(){f.onoff?f.activate(!f.$d.hasClass("active")):f.activate(!0);return!1});f.tt&&(a=f.tb.orientation||"h",f.tb.position?c.tooltip.add(f.$d,"h"===a?f.tb.position.substr(0,1):f.tb.position.substr(1,2)):c.tooltip.add(f.$d,"h"===a?"n":"e"));return this};this.trigger=function(){this.$d.trigger("click")};this.activate=function(a){var d,c;if(a){a=0;for(d=this.tb.items.length;a<d;a++)if(c=this.tb.items[a],c.id!==this.id){if($.isFunction(c.ondeactivate))c.ondeactivate(c.scope,
c);c.$d.removeClass("active")}this.$d.addClass("active");if($.isFunction(this.onactivate))this.onactivate(this.scope,this)}else if(this.$d.removeClass("active"),$.isFunction(this.ondeactivate))this.ondeactivate(this.scope,this);return!0};return this.init()}})(window.M);
(function(c){c.Mask=function(){if(c.Mask._o)return c.Mask._o;this.activeRequests=[];this.init=function(){this.$m=c.Util.$$("#"+c.Util.getId(),c.$container).addClass("mask").css({position:"absolute",display:"none",left:"0",top:"0",width:"100%",height:"100%","z-index":"35000"}).html('<div class="content"><div class="loading"></div></div>');this.$l=$(".loading",this.$m)};this.abort=function(c){for(var a in this.activeRequests)if(c){if(a===c){this.activeRequests[a]&&this.activeRequests[a].abort();delete this.activeRequests[a];
$("#"+a).remove();break}}else this.activeRequests[a]&&this.activeRequests[a].abort(),delete this.activeRequests[a],$("#"+a).remove();$("#"+c).remove();0===this.$l.children().length&&this.hide()};this.add=function(e){var a=this;$.extend(e,{title:e.title||"",cancel:e.cancel||!1,layer:e.layer||null,id:e.id||c.Util.getId(),request:e.request||null});e.request&&(this.activeRequests[e.id]=e.request);e.cancel?(this.$l.append('<div id="'+e.id+'">'+e.title+'&nbsp;(<a href="#" id="aj'+e.id+'">'+c.Util._("Cancel")+
"</a>)</div>"),$("#aj"+e.id).click(function(){a.abort(e.id)})):this.$l.append('<div id="'+e.id+'">'+e.title+"</div>");e.layer&&c.Map.events.register("layersend",e,function(b,d,f){"remove"!=b&&d.id===f.layer.id&&(c.Map.events.unRegister(f),b=c.Plugins.LayersManager,d._tobedestroyed||b&&b._o&&b._o.show(b._o.get(d._M.MID)),a.abort(f.id))});this.show();return e.id};this.show=function(e){this.$m.show();e||c.activity.show()};this.hide=function(){this.$l.empty();this.$m.hide();c.activity.hide()};this.init();
c.Mask._o=this;return this}})(window.M);
(function(c){c.Tooltip=function(){if(c.Tooltip._o)return c.Tooltip._o;this.init=function(){this.$t=c.Util.$$("#mapshup-tooltip");this.c=null};this.add=function(e,a,b){var d=this,b=b||0;c.Util.device.touch||e.hover(function(){var c=$(this);if(c&&(d.c=d.c||[""],c[0]!==d.c[0])){d.c=c;d.$t.html('<div class="inner">'+c.attr("jtitle")+"</div>");var g=d.$t.width(),e=d.$t.height(),j=c.offset().top,k=c.offset().left,m=c.width(),c=c.height();switch(a){case "n":d.$t.css({top:j+c+5+b,left:k+m/2-g/2});break;case "s":d.$t.css({top:j-
e-20-b,left:k+m/2-g/2});break;case "e":d.$t.css({top:j+c/2-e/2,left:k-g-10-b});break;case "w":d.$t.css({top:j+c/2-e/2,left:k+m+10+b});break;case "nw":d.$t.css({top:j+c+5+b,left:k})}d.$t.show()}},function(){d.remove()})};this.remove=function(){this.$t.hide();this.c=null};this.init();c.Tooltip._o=this;return this}})(window.M);
(function(c){c.Menu=function(e){if(c.Menu._o)return c.Menu._o;this.lonLat=new OpenLayers.LonLat(0,0);this.isLoaded=!1;this.items=[];this.limit=e||0;this.isNull=!1;this.init=function(){if(this.isLoaded)return this;if(!c.Config.general.displayContextualMenu)return this.isNull=this.isLoaded=!0,this.$m=$(),this;c.$map.append('<div id="menu"><div class="cross"><img src="'+c.Util.getImgUrl("x.png")+'"</div></div>');this.$m=$("#menu");this.add([{id:c.Util.getId(),ic:"x.png",ti:"Close menu",cb:function(){}}]);
this.isLoaded=!0;return this};this.add=function(a){if(this.isNull)return!1;if($.isArray(a)){for(var b=0,d=a.length;b<d;b++)this.items.push(a[b]);this.refresh()}return!0};this.refresh=function(){var a,b,d,f,e=this,h=135,j=!0,k=e.items.length,m=180/k,n=40*Math.sqrt(k),p=1.3*n;$(".item",e.$m).remove();for(a=0;a<k;a++)(function(a,k){45<h&&135>h?(h=135+h,j=!0):225<h&&315>h&&(h=180-h+m,j=!1);f=h*Math.PI/180;j?(k.append('<div class="item right" id="'+a.id+'">'+c.Util._(a.ti)+'&nbsp;<img class="middle" src="'+
c.Util.getImgUrl(a.ic)+'"/></div>'),b=Math.cos(f)*n-200+80):(k.append('<div class="item left" id="'+a.id+'"><img class="middle" src="'+c.Util.getImgUrl(a.ic)+'"/>&nbsp;'+c.Util._(a.ti)+"</div>"),b=Math.cos(f)*n-80);d=Math.sin(f)*p-10;$("#"+a.id).click(function(){e.hide();a.cb(e);return!1}).css({left:Math.round(b),top:Math.round(d)});h+=m})(e.items[a],e.$m)};this.remove=function(a){for(var b=0,d=this.items.length;b<d;b++)if(this.items[b].id===a)return this.items.splice(b,1),this.refresh(),!0;return!1};
this.show=function(){var a,b;if(!this.isNull&&c.Map.mouseClick){a=c.Map.mouseClick.x;b=c.Map.mouseClick.y;if(b<this.limit||b>c.$map.height()-this.limit||a<this.limit||a>c.$map.width()-this.limit)return this.$m.hide(),!1;this.lonLat=c.Map.map.getLonLatFromPixel(c.Map.mouseClick)}else return!1;this.isLoaded||this.init();this.$m.css({left:a,top:b}).show();return!0};this.updatePosition=function(){if(this.isNull)return!1;var a=c.Map.map.getPixelFromLonLat(this.lonLat);this.$m.css({left:a.x,top:a.y});return!0};
this.hide=function(){if(this.isNull)return!1;this.$m.hide();return!0};this.init();c.Menu._o=this;return this}})(window.M);
(function(c){c.TabPaginator=function(e){this.target=e.target;this.$container=e.$container||c.$container;this.left=e.left||0;this.page=0;this.init=function(){var a=c.Util.getId(),b=c.Util.getId(),d=this;if(!d.target)return null;d.target.$d.append('<a id="'+a+'" class="tab ptab">&laquo;</a><a id="'+b+'" class="tab ptab">&raquo;</a>');d.$prev=$("#"+a).click(function(a){a.preventDefault();a.stopPropagation();d.goTo(d.page-1)}).css({left:d.left});d.$next=$("#"+b).click(function(a){a.preventDefault();a.stopPropagation();
d.goTo(d.page+1)}).css({left:d.$prev.offset().left+d.$prev.outerWidth()});c.events.register("resizeend",d,function(a){var b,d,c;a.refresh();if(a.target&&a.target.items){b=0;for(d=a.target.items.length;b<d;b++)c=a.target.items[b],$("ul",c.$d).css("left",0),a.updatePaginate(c)}});return this};this.nbOfPages=function(){return Math.ceil(this.target.items.length/this.nbOfTabsPerPage())-1};this.nbOfTabsPerPage=function(){return Math.round(2*this.$container.width()/3/200)};this.refresh=function(){var a,
b,d;if(this.target)if(d=this.target.$d,$(".tab",d).hide(),b=this.nbOfTabsPerPage(),a=this.nbOfPages(),this.page>a&&(this.page=a),0>this.page)this.page=0,$(".ptab",d).hide();else{0===a?$(".ptab",d).hide():$(".ptab",d).show();a=b*this.page;b=Math.min(a+b,this.target.items.length);this.target.items[a]&&this.target.items[a].$tab.css({left:this.$next.is(":visible")?this.$next.position().left+this.$next.outerWidth():this.left}).show();for(a+=1;a<b;a++)d=this.target.items[a-1].$tab,this.target.items[a].$tab.css({left:d.position().left+
d.outerWidth()+10}).show()}};this.getPageIdx=function(a){for(var b=0,d=this.target.items.length;b<d;b++)if(this.target.items[b].id===a.id)return b/this.nbOfTabsPerPage()|0;return-1};this.goTo=function(a){var b=this.nbOfPages();this.page=0>a?b:a>b?0:a;this.refresh()};this.updatePaginate=function(a){var b=$("ul",a.$d),d=$("#"+a.id+"p"),c=$("#"+a.id+"n");0<$("li",b).size()&&(0>$("li",b).first().offset().left?d.show():d.hide(),$("li",b).last().offset().left>$(".thumbsWrapper",a.$d).width()?c.show():c.hide())};
return this.init()}})(window.M);
(function(c){c.SouthPanel=function(e){e=e||{};this.active=null;this.h=c.Util.getPropertyValue(e,"h",300);this.w=c.Util.getPropertyValue(e,"w","70%");this.items=[];this.over=c.Util.getPropertyValue(e,"over",!0);this.padding={top:0,bottom:0,right:0};this.init=function(){if(c.SouthPanel._o)return c.SouthPanel._o;-1===this.h&&(this.h=Math.max(Math.round(2*c.$map.height()/5),300));this._offset=c.$container.offset().top;this.$d=c.Util.$$("#"+c.Util.getId(),this.over?c.$mcontainer:c.$container).addClass("pns").css({bottom:-this.h,
height:this.h,width:this.over?this.w:"100%"});c.events.register("resizeend",this,function(a){a.over||a.$d.width(c.$container.width())});this.paginator=new c.TabPaginator({target:this,$mcontainer:this.$d});c.SouthPanel._o=this;return this};this.add=function(a){if(!a||!a.id)return!1;var b,d,f=this;a.unremovable=c.Util.getPropertyValue(a,"unremovable",!0);b=f.get(a.id);b||(b={id:a.id,pn:f,$d:c.Util.$$("#"+a.id,f.$d).addClass("pnsi"+(f.over?"t":"")).css({margin:f.padding.top+"px "+(f.over?f.padding.right:
0)+"px "+f.padding.bottom+"px 0px"})},d=c.Util.getId(),f.$d.append('<a id="'+d+'t" class="tab vtab">'+(a.icon?'<img src="'+a.icon+'">&nbsp;':"")+c.Util._(a.title)+"</a>"),b.$tab=$("#"+d+"t"),b.$tab.click(function(a){a.preventDefault();!f.active||f.active.id!==b.id?f.show(b):f.hide(b)}),a.unremovable||c.Util.addClose(b.$tab,function(a){a.stopPropagation();f.remove(b)}),f.items.unshift(b));d=c.Util.getId();b.$d.html((a.mask?'<div id="'+d+'mask" class="mask" style="display:none;width:100%;height:'+f.h+
'px;"></div>':"")+'<div id="'+d+'" style="height:'+(f.h-f.padding.top-f.padding.bottom)+'px"'+(a.classes?' class="'+a.classes+'"':"")+">"+(a.html||"")+"</div>");$.extend(b,{$content:$("#"+d),$mask:$("#"+d+"mask"),onclose:a.onclose,onshow:a.onshow});f.paginator.refresh();return b};this.remove=function(a){var b,d;if(!a)return!1;b=0;for(d=this.items.length;b<d;b++)if(this.items[b].id===a.id)return this.hide(a),this.items[b].$content.remove(),this.items[b].$d.remove(),this.items[b].$tab.remove(),this.items.splice(b,
1),this.paginator.refresh(),!0;return!1};this.show=function(a){var b=this;if(!a)return!1;b.setActive(a);if(b.isVisible){if($.isFunction(a.onshow))a.onshow();return!1}b.$d.stop().animate({bottom:"0px"},{duration:200,queue:!0,step:function(a){b.over||c.$container.css("top",-a-b.h+b._offset)},complete:function(){c.Map.map.updateSize();if($.isFunction(a.onshow))a.onshow()}});return b.isVisible=!0};this.get=function(a){var b,d,c=null;b=0;for(d=this.items.length;b<d;b++)if(this.items[b].id===a){c=this.items[b];
break}return c};this.hide=function(a){var b=this;if(!b.active||b.active.id!==a.id)return!1;b.active=null;a.$tab.removeClass("active");b.isVisible=!1;b.$d.stop().animate({bottom:-b.h},{duration:200,queue:!0,step:function(a){b.over||c.$container.css("top",-a-b.h+b._offset)},complete:function(){c.Map.map.updateSize();if($.isFunction(a.onclose))a.onclose()}});return!0};this.setActive=function(a){$(".pnsi,.pnsit",this.$d).each(function(){var a=$(this);a.hasClass("nodisplaynone")?a.css({position:"absolute",
top:"-1000px",left:"-1000px"}):a.hide()});$(".tab",this.$d).removeClass("active");a.$d.hasClass("nodisplaynone")?a.$d.css({position:"static",top:"0px",left:"0px"}):a.$d.show();a.$tab.addClass("active");this.active=a};return this.init()}})(window.M);
(function(c){c.SidePanel=function(e){e=e||{};this.active=null;this.items=[];this.w=c.Util.getPropertyValue(e,"w",400);this.over=c.Util.getPropertyValue(e,"over",!0);this.padding={top:0,bottom:0,right:0};this.init=function(){if(c.SidePanel._o)return c.SidePanel._o;this.$d=c.Util.$$("#"+c.Util.getId(),this.over?c.$mcontainer:c.$container).addClass("spn").css({right:-this.w,height:"100%",width:this.w});c.SidePanel._o=this;return this};this.show=function(a){var b=this;b.setActive(a);if(b.isVisible)return!1;
if(b.over){var d=new c.Toolbar({position:"ne",orientation:"v"});b.$d.stop().animate({right:"0"},{duration:200,queue:!0,step:function(a){d.$d.css("right",b.w+a)}})}else b.$d.stop().animate({right:0},{duration:200,queue:!0,step:function(a){c.$mcontainer.css("left",-a-b.w)},complete:function(){c.Map.map.updateSize()}});return b.isVisible=!0};this.hide=function(a){var b=this;if(!b.isVisible||a&&b.active&&b.active.id!==a.id)return!1;b.isVisible=!1;if(b.over){var d=new c.Toolbar({position:"ne",orientation:"v"});
b.$d.stop().animate({right:-b.w},{duration:200,queue:!0,step:function(a){d.$d.css("right",b.w+a)}})}else b.$d.stop().animate({right:-b.w},{duration:200,queue:!0,step:function(a){c.$mcontainer.css("left",-a-b.w)},complete:function(){c.Map.map.updateSize()}});return!0};this.add=function(a){if(!a||!a.id)return!1;var b,d=c.Util.getId();b=this.get(a.id);b||(b={id:a.id,pn:this,$d:c.Util.$$("#"+a.id,this.$d).css({margin:this.padding.top+"px "+(this.over?this.padding.right:0)+"px "+this.padding.bottom+"px 0px"})},
this.items.unshift(b));b.$d.html('<div id="'+d+'"'+(a.classes?' class="'+a.classes+'"':"")+">"+(a.html||"")+"</div>");$.extend(b,{$content:$("#"+d),onclose:a.onclose,onshow:a.onshow});return b};this.remove=function(a){var b,d;if(!a)return!1;b=0;for(d=this.items.length;b<d;b++)if(this.items[b].id===a.id)return this.hide(a),this.items[b].$content.remove(),this.items[b].$d.remove(),this.items[b].$tab.remove(),this.items.splice(b,1),!0;return!1};this.get=function(a){var b,d,c=null;b=0;for(d=this.items.length;b<
d;b++)if(this.items[b].id===a){c=this.items[b];break}return c};this.setActive=function(a){var b,d;if(!a)return!1;b=0;for(d=this.items.length;b<d;b++)this.items[b].$d.hide();a.$d.show();this.active=a;return!0};return this.init()}})(window.M);
(function(c){c.Popup=function(e){e=e||{};this.autoSize=c.Util.getPropertyValue(e,"autoSize",!1);this.classes=e.classes;this.centered=c.Util.getPropertyValue(e,"centered",!0);this.addCloseButton=c.Util.getPropertyValue(e,"addCloseButton",!0);this.onClose=e.onClose;this.parent=e.parent||c.$mcontainer;this.generic=c.Util.getPropertyValue(e,"generic",!0);this.hideOnClose=c.Util.getPropertyValue(e,"hideOnClose",!1);this.modal=c.Util.getPropertyValue(e,"modal",!1);this.noHeader=c.Util.getPropertyValue(e,
"noHeader",!1);this.noFooter=c.Util.getPropertyValue(e,"noFooter",!0);this.resize=c.Util.getPropertyValue(e,"resize",!0);this.scope=e.scope||this;this.unbounded=c.Util.getPropertyValue(e,"unbounded",!1);this.followMap=c.Util.getPropertyValue(e,"followMap",!1);this.mapXY=e.mapXY;this.zIndex=c.Util.getPropertyValue(e,"zIndex",35900);this.init=function(a){var b=this,a=a||{};b.$m=$();b.$d=c.Util.$$("#"+c.Util.getId(),b.parent).addClass("po").html((b.noHeader?"":'<div class="header"></div>')+'<div class="body'+
(b.generic?" generic":"")+'"></div>'+(!b.noFooter?'<div class="footer"></div>':""));b.modal?(b.$d.css({"z-index":"38600"}),b.$m=c.Util.$$("#modmask",b.parent).addClass("mask").css({position:"absolute",display:"none",left:"0",top:"0",width:"100%",height:"100%","z-index":"36000"})):b.$d.css({"z-index":b.followMap?"19000":b.zIndex});b.$d.addClass(b.classes?b.classes:b.autoSize?"poa":"pona");b.$b=$(".body",b.$d);b.$h=$(".header",b.$d);b.$f=$(".footer",b.$d);a.header&&b.$h.html(a.header);a.body&&b.$b.html(a.body);
a.footer&&b.$f.html(a.footer);b.addCloseButton&&c.Util.addClose(b.$d,function(){b.hideOnClose?b.hide():b.remove()});c.events.register("resizeend",b,function(a){a.updatePosition(a)});a.followMap&&c.Map.map.events.register("move",c.Map.map,function(){b.$d.is(":visible")&&b.updatePosition(b)});b.mapXY&&this.setMapXY(b.mapXY);b.updatePosition(b);return b};this.append=function(a,b){("header"===b?this.$h:this.$b).append(a);this.updatePosition(this)};this.updatePosition=function(a){a=a||this;a.resize&&a.$b.css({"max-height":Math.round(1*
(c.$container.height()-a.$h.height())/2)});a.centered&&a.center(a);a.followMap&&a.mapXY&&a.setMapXY(a.mapXY)};this.center=function(a){a=a||this;a.$d.css({left:(c.$container.width()-a.$d.width())/2})};this.hide=function(a){this.$d.hide();this.$m.hide();if(!a&&$.isFunction(this.onClose))this.onClose(this.scope)};this.setMapXY=function(a){this.mapXY=a;a=c.Map.map.getPixelFromLonLat(this.mapXY);this.$d.hasClass("apo")?this.$d.css({left:a.x-31,top:a.y-this.$d.outerHeight()-12}):this.$d.css({left:a.x-this.$d.outerWidth()/
2,top:a.y-this.$d.outerHeight()/2})};this.moveTo=function(a){var b,d,f=this.$d;b=c.$map;var e=b.offset();if(!this.resize)return!1;d={x:a.x+e.left,y:a.y+e.top};!d||!d.x||!d.y?(a=e.left+(b.width()-f.width())/2,b=e.top+(b.height()-f.height())/2):this.unbounded?(a=d.x-f.width()/2,b=d.y-f.height()/2):(a=d.x-f.width()/2<e.left?e.left:d.x+f.width()/2>e.left+b.width()?e.left+b.width()-f.width():d.x-f.width()/2,b=d.y-f.height()/2<e.top?e.top:d.y+f.height()/2>e.top+b.height()?e.top+b.height()-f.height():d.y-
f.height()/2);f.css({top:b,left:a});return!0};this.remove=function(){this.hide();c.remove(this)};this.show=function(){this.$d.show();this.$m.show();if(this.followMap){var a=$(".lm").offset(),a=this.$d.offset().top-c.$map.offset().top-(a?a.top:0),b=c.$map.offset().left+c.$map.width()-this.$d.offset().left-this.$d.outerWidth(),d;0<b&&(b=0);0<a&&(a=0);if(0>b||0>a)d=c.Map.map.getPixelFromLonLat(c.Map.map.getCenter()),c.Map.map.setCenter(c.Map.map.getLonLatFromPixel(new OpenLayers.Pixel(d.x-b,d.y+a)))}};
this.init(e);return this}})(window.M);
(function(c){c=c||{};c.Map={$featureHilite:$(),doNotLog:!1,currentState:null,clusterOpts:{distance:30,threshold:3},pc:new OpenLayers.Projection("EPSG:4326"),sm:new OpenLayers.Projection("EPSG:900913"),layersGroups:[],layerTypes:[],map:null,mouseClick:new OpenLayers.Pixel(0,0),mousePosition:new OpenLayers.Pixel(0,0),predefined:{items:[],add:function(e){var a,b,d,f=!0;if(!e||!e.hasOwnProperty("type"))return!1;this.items[e.type]=this.items[e.type]||[];d=this.items[e.type];a=0;for(b=d.length;a<b;a++)if((new c.Map.LayerDescription(d[a],
c.Map)).getMID()===(new c.Map.LayerDescription(e,c.Map)).getMID()){f=!1;break}f&&d.push(e);return!0}},refreshCycle:0,selectableLayers:{items:[],add:function(e){e.events.on({featureselected:function(a){c.Map.featureInfo.select(a.feature)},featureunselected:function(a){c.Map.featureInfo.unselect(a.feature)}});this.items.push(e);e._M.hilitable&&c.Map.hilitableLayers.add(e);c.Map.resetControl()},remove:function(e){for(var a=0,b=this.items.length;a<b;a++)if(this.items[a].id===e.id){this.items.splice(a,
1);break}c.Map.hilitableLayers.remove(e)}},hilitableLayers:{items:[],add:function(c){this.items.push(c)},remove:function(c){for(var a=0,b=this.items.length;a<b;a++)if(this.items[a].id===c.id){this.items.splice(a,1);break}}},addToStuffLayer:function(c,a){if("object"!==typeof c)return null;a=a||{};this._stuffLayer||(this._stuffLayer=this.addLayer({type:"GeoJSON",title:"Stuff",clusterized:!1,editable:!0,unremovable:!0,ol:{styleMap:new OpenLayers.StyleMap({"default":{strokeColor:"white",strokeWidth:1,
fillColor:"red",fillOpacity:0.2,pointRadius:5}})}}));return this.layerTypes.GeoJSON.load({data:c,layer:this._stuffLayer,zoomOnNew:a.zoomOn||!1})},addLayer:function(e,a){var a=a||{},b=c.Util.getPropertyValue(a,"noDeletionCheck",!1),d=new this.LayerDescription(e,this);if(!d.isValid())return null;var f=d.getLayerType();if(!f)return null;var g=d.getMID(),h=this.Util.getLayerByMID(g);if(h){if(!b&&c.Config.general.confirmDeletion)return c.Util.askFor({title:c.Util._("Delete layer"),content:c.Util._("Do you really want to remove layer")+
" "+h.name,dataType:"list",value:[{title:c.Util._("Yes"),value:"y"},{title:c.Util._("No"),value:"n"}],callback:function(a){"y"===a&&(c.Map.removeLayer(h),c.Map.addLayer(e))}}),null;c.Map.removeLayer(h)}b=d.obj;b.url&&(b.url=c.Util.getAbsoluteUrl(b.url));var j={},k;for(k in b.ol)j[k]=b.ol[k];j._M={allowChangeOpacity:c.Util.getPropertyValue(b,"allowChangeOpacity",!1),clusterized:c.Util.getPropertyValue(b,"clusterized",c.Util.getPropertyValue(f,"clusterized",!1)),count:0,editable:c.Util.getPropertyValue(b,
"editable",!1),group:null,hilitable:c.Util.getPropertyValue(b,"hilitable",c.Util.getPropertyValue(f,"hilitable",!0)),icon:c.Util.getPropertyValue(b,"icon",c.Util.getImgUrl(c.Util.getPropertyValue(f,"icon",null))),initial:c.Util.getPropertyValue(b,"initial",!1),initialized:c.Util.getPropertyValue(a,"forceInitialized",!1),isLoaded:!0,isRaster:f.isRaster?!0:!1,MID:g,layerDescription:b,MLayer:c.Util.getPropertyValue(b,"MLayer",!1),noZoomOn:c.Util.getPropertyValue(b,"noZoomOn",!1),pagination:c.Util.getPropertyValue(b,
"pagination",null),qlToMap:c.Util.getPropertyValue(b,"qlToMap",!1),refreshable:c.Util.getPropertyValue(b,"refreshable",!1),refreshFactor:c.Util.getPropertyValue(b,"refreshFactor",1),selectable:c.Util.getPropertyValue(b,"selectable",c.Util.getPropertyValue(f,"selectable",!1)),unremovable:c.Util.getPropertyValue(b,"unremovable",!1),microInfoTemplate:c.Util.getPropertyValue(b,"microInfoTemplate",{})};c.Util.device.touch&&(j._M.microInfoTemplate.enable=!0);f.hasOwnProperty("projection")&&(j.projection=
f.projection);f.hasStyleMap&&!j.hasOwnProperty("styleMap")&&(j.styleMap=d.getStyleMap());if(h=f.add(b,j))h._M.layerDescription&&h._M.layerDescription.zoomOnNew&&this.zoomTo(h.getDataExtent()||h._M.bounds,"always"===h._M.layerDescription.zoomOnNew?!1:!0),(!h.events.listeners.hasOwnProperty("loadstart")||0===h.events.listeners.loadstart.length)&&h.events.register("loadstart",h,function(){c.Map.events.trigger("loadstart",h)}),(!h.events.listeners.hasOwnProperty("loadend")||0===h.events.listeners.loadend.length)&&
h.events.register("loadend",h,function(){c.Map.resetControl();c.Map.events.trigger("loadend",h);var a=c.Map.layerTypes[this._M.layerDescription.type];return a&&a.removeOnEmpty&&c.Map.Util.layerIsEmpty(this)?(c.Util.message(c.Util._("No result")),c.Map.removeLayer(this)):this._M.initialized=!0}),b&&!0===b.hidden&&this.Util.setVisibility(h,!1),this.map.addLayer(h),c.timeLine&&c.timeLine.add(h),h.isBaseLayer&&!this.hasNonEmptyBaseLayer&&(this.setBaseLayer(h),this.removeLayer(this.Util.getLayerByMID("EmptyBaseLayer"),
!1),this.hasNonEmptyBaseLayer=!0),f&&f.forceReload&&h.redraw(),h._M&&h._M.selectable&&this.selectableLayers.add(h),h._M.layerDescription&&h._M.layerDescription.groupName&&(d=this.layersGroups[h._M.layerDescription.groupName],d||(d=new this.LayersGroup(h._M.layerDescription.groupName,null),this.layersGroups[h._M.layerDescription.groupName]=d),h._M.group=d,d.add(h)),this.events.trigger("layersend",{action:"add",layer:h}),b.opacity&&h.setOpacity(b.opacity);return h},getState:function(){return{center:this.map.getCenter(),
resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getUnits()||this.map.units||this.map.baseLayer.units}},loadContext:function(e){var a,b,d,f,g,h,j,e=e||{};e.location&&this.map.setCenter(this.Util.d2p(new OpenLayers.LonLat(e.location.lon,e.location.lat)),Math.max(e.location.zoom,this.lowestZoomLevel));e.layers=e.layers||[];f=0;for(j=this.map.layers.length;f<j;f++)if(b=!0,(d=this.map.layers[f])&&d._M&&!d._M.MLayer){a=d._M.MID;g=0;for(h=e.layers.length;g<h;g++)if(a===
(new this.LayerDescription(e.layers[g],this)).getMID()){b=!1;break}b&&this.removeLayer(this.Util.getLayerByMID(a),!1)}f=0;for(j=e.layers.length;f<j;f++){a=(new this.LayerDescription(e.layers[f],this)).getMID();b=!0;g=0;for(h=this.map.layers.length;g<h;g++)if(d=this.map.layers[g],d._M&&!d._M.MLayer&&a===d._M.MID){b=!1;break}if(b)this.addLayer(e.layers[f],{noDeletionCheck:!0,forceInitialized:!0});else if(d.isBaseLayer||c.Map.Util.setVisibility(d,!e.layers[f].hidden),a=e.layers[f].search)d._M.searchContext.items=
a.items,d._M.searchContext.search({nextRecord:a.nextRecord})}e.location.bg&&(d=this.Util.getLayerByMID(e.location.bg))&&d.isBaseLayer&&this.setBaseLayer(d)},getContext:function(){var c,a,b,d,f,g;c=this.Util.p2d(this.map.getCenter());d={location:{bg:this.map.baseLayer._M.MID,lat:c.lat,lon:c.lon,zoom:this.map.getZoom()},layers:[]};c=0;for(a=this.map.layers.length;c<a;c++)if(b=this.map.layers[c],b._M&&b._M.layerDescription&&!b._M.MLayer){g={initial:!0};for(f in b._M.layerDescription)"layer"!==f&&"ol"!==
f&&(g[f]=b._M.layerDescription[f]);g.hidden=!b.getVisibility()&&!b.isBaseLayer?!0:!1;b._M.searchContext&&0<b._M.searchContext.items.length&&(g.search={MID:b._M.MID,items:b._M.searchContext.items,nextRecord:b._M.searchContext.nextRecord});d.layers.push(g)}return d},init:function(e){var a=this;OpenLayers.IMAGE_RELOAD_ATTEMPTS=2;OpenLayers.ProxyHost=c.Util.proxify("");OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler.Feature,{stopDown:!1});OpenLayers.Layer.Vector.prototype.renderers=["SVG",
"VML"];e.mapOptions.theme=null;a.initialLocation=e.general.location;if("auto"===c.$map.css("height")||"0px"===c.$map.css("height"))c.$map.css("height",window.innerHeight-c.$map.offset().top),c.$map.addClass("processHeightOnResize");var b={id:"__CONTROL_NAVIGATION__",documentDrag:!0,handleRightClicks:!0,zoomWheelEnabled:!0,mouseWheelOptions:{interval:50,cumulative:!1},dragPanOptions:{enableKinetic:!0,panMapStart:function(b){this.kinetic&&this.kinetic.begin();a._clk={x:b.x,y:b.y,d:(new Date).getTime()};
return!0},panMapUp:function(b){a._clk&&(b.x===a._clk.x&&b.y===a._clk.y)&&(200<(new Date).getTime()-a._clk.d?(a.mouseClick={x:b.x,y:b.y},c.menu.show()):c.Map.events.trigger("mapclicked",b));return!0}}};e.mapOptions.controls=c.Util.device.touch?[new OpenLayers.Control.TouchNavigation(b)]:[new OpenLayers.Control.Navigation(b)];a.map=new OpenLayers.Map(c.$map.attr("id"),e.mapOptions);a.map.addLayer(new OpenLayers.Layer("EmptyBaseLayer",{_M:{MID:"EmptyBaseLayer"},isBaseLayer:!0,displayInLayerSwitcher:!1}));
a.events=new a.Events(a);a.featureInfo=new a.FeatureInfo;a.map.events.register("move",a.map,function(){c.menu&&c.menu.updatePosition()});a.map.events.register("moveend",a,function(){c.Map.events.trigger("moveend");a.currentState=c.Map.getState();!a._bof&&c.Config.general.enableHistory&&(a.hash=c.Map.Util.Geohash.encode(a.Util.p2d(a.map.getCenter().clone()))+":"+a.map.getZoom(),window.location.hash=a.hash);a._bof=!1});setInterval(function(){if(a.hash&&window.location.hash!==a.hash){a.hash=window.location.hash;
a._bof=!0;var b=a.hash.split(":");a.map.setCenter(a.Util.d2p(a.Util.Geohash.decode(b[0])),parseInt(b[1]))}},100);c.Util.device.touch||(e.general.displayCoordinates&&(0===$("#coords").length&&c.Util.$$("#coords",c.$map),a.$coords=$("#coords")),e.general.featureHilite&&0===a.$featureHilite.length&&(a.$featureHilite=c.Util.$$("#"+c.Util.getId(),c.$map).addClass("featureHilite").hide()),a.map.events.register("mousemove",a.map,function(b){var d=c.$map.offset();c.Map.mousePosition=new OpenLayers.Pixel(b.pageX-
d.left,b.pageY-d.top);e.general.displayCoordinates&&c.Map.$coords.html(c.Map.Util.getFormattedLonLat(a.Util.p2d(c.Map.map.getLonLatFromPixel(c.Map.mousePosition)),c.Config.general.coordinatesFormat)).css({top:c.Map.mousePosition.y-20,left:c.Map.mousePosition.x}).show();a.$featureHilite.css({top:c.Map.mousePosition.y+30,left:c.Map.mousePosition.x+15});return!0}),a.map.events.register("mouseout",a.map,function(){c.Map.$coords&&c.Map.$coords.hide();a.$featureHilite.hide();return!0}));if(e.groups)for(var b=
0,d=e.groups.length;b<d;b++)a.layersGroup[e.groups.name]=new a.LayersGroup(a,e.groups.name,e.groups.icon);b=[];e.general.displayScale&&$.isFunction(OpenLayers.Control.ScaleLine)&&b.push(new OpenLayers.Control.ScaleLine({id:"__CONTROL_SCALELINE__",geodetic:"EPSG:4326"===a.map.getProjectionObject().projCode?!1:!0}));b.push(new OpenLayers.Control.SelectFeature(a.selectableLayers.items,{id:"__CONTROL_SELECT__",clickout:!1,toggle:!0,multiple:!1,hover:!1}));e.general.featureHilite&&b.push(new OpenLayers.Control.SelectFeature(a.hilitableLayers.items,
{id:"__CONTROL_HIGHLITE__",hover:!0,highlightOnly:!0,eventListeners:{beforefeaturehighlighted:function(b){if(c.menu&&c.menu.$m.is(":visible"))return!1;if(b.feature){b.feature.geometry&&$("#"+b.feature.geometry.id).css("cursor","pointer");if(c.Map.featureInfo.hilited)return a.$featureHilite.empty().hide(),!0;if(c.Map.featureInfo.selected&&c.Map.featureInfo.selected.id===b.feature.id)return a.$featureHilite.empty().hide(),!1;a.$featureHilite.html(c.Util.stripTags(c.Map.Util.Feature.getTitle(b.feature))).attr("hilited",
"hilited").show()}return!0},featureunhighlighted:function(){a.$featureHilite.empty().attr("hilited","").hide()}}}));b.push(new OpenLayers.Control.Attribution({id:"__CONTROL_ATTRIBUTION__"}));a.map.addControls(b);"none"!==e.general.overviewMap&&(b=new OpenLayers.Bounds(-180,-90,180,90),b=new OpenLayers.Control.OverviewMap({mapOptions:{theme:!1,projection:this.map.displayProjection,maxExtent:b,numZoomLevels:1,autoPan:!1,restrictedExtent:b},maximized:"opened"===e.general.overviewMap?!0:!1,size:new OpenLayers.Size("250",
"125"),layers:[new OpenLayers.Layer.Image("ImageLayer",c.Util.getImgUrl("overviewmap.png"),b,new OpenLayers.Size("250","125"))]}),a.map.addControl(b));a.map.restrictedExtent?a.map.zoomToExtent(a.map.restrictedExtent):a.setCenter(a.Util.d2p(new OpenLayers.LonLat(a.initialLocation.lon,a.initialLocation.lat)),a.initialLocation.zoom,!0);a.lowestZoomLevel=0;(function g(){c.Map.refreshCycle++;var a,b;for(a=c.Map.map.layers.length;a--;)b=c.Map.map.layers[a],!b.isBaseLayer&&b._M&&b._M.refresh&&0===c.Map.refreshCycle%
b._M.refreshFactor&&b.refresh({force:!0});window.setTimeout(g,c.Config.general.refreshInterval||1E3)})();a.resetControl(a.Util.getControlById("__CONTROL_NAVIGATION__"));c.events.register("resizeend",a,function(a){a.map.updateSize();a.events.trigger("resizeend")})},removeLayer:function(e,a){if(!e)return!1;if(a&&c.Config.general.confirmDeletion)return c.Util.askFor({title:c.Util._("Delete layer"),content:c.Util._("Do you really want to remove layer")+" "+e.name,dataType:"list",value:[{title:c.Util._("Yes"),
value:"y"},{title:c.Util._("No"),value:"n"}],callback:function(a){"y"===a&&c.Map.removeLayer(e)}}),!1;e._tobedestroyed=!0;this.events.trigger("layersend",{action:"remove",layer:e});this.selectableLayers.remove(e);e._M&&e._M.group&&e._M.group.remove(e);e._M&&e._M.SearchContext&&c.remove(e._M.SearchContext);c.timeLine&&c.timeLine.remove(e);e._M&&e._M.MLayer&&this.removedLayers.push({MID:e._M.MID,layerDescription:e._M.layerDescription});e.destroy();return!0},resetControl:function(c){c&&(c.deactivate(),
this.Util.getControlById("__CONTROL_NAVIGATION__").activate());var c=this.Util.getControlById("__CONTROL_SELECT__"),a=this.Util.getControlById("__CONTROL_HIGHLITE__");c&&(c.deactivate(),a&&a.deactivate(),0<this.selectableLayers.items.length&&(a&&a.activate(),c.activate()))},setCenter:function(e,a,b){this.doNotLog=b||!1;null!==a?this.map.setCenter(e,a):c.Util.device.touch||c.Config.general.teleport?this.map.setCenter(e):this.map.panTo(e)},zoomTo:function(e,a){if(e&&(!a||!this.map.getExtent().containsBounds(e,
!0))){var b=e.getWidth(),d=e.getHeight(),f=e.getCenterLonLat(),g=c.Util._("Cannot zoom : this feature is outside authorized extent");1>b&&1>d?this.map.restrictedExtent&&!this.map.restrictedExtent.containsBounds(e,!0)?c.Util.message(g):this.map.setCenter(f,Math.max(9,this.map.getZoom())):this.map.restrictedExtent&&!this.map.restrictedExtent.containsBounds(e,!0)?c.Util.message(g):this.map.zoomToExtent(e)}},setBaseLayer:function(c){var a,b,d;this.map.setBaseLayer(c);this.map.baseLayer.wrapDateLine=!1;
b=this.map.projection&&this.map.projection instanceof OpenLayers.Projection?this.map.projection:new OpenLayers.Projection(this.map.projection);d=c.projection;if(!d.equals(b)){this.map.projection=d;this.map.maxExtent=c.maxExtent;this.map.setCenter(this.map.getCenter().transform(b,d),this.map.getZoom(),!1,!0);for(c=0;c<this.map.layers.length;c++)if(!1===this.map.layers[c].isBaseLayer){this.map.layers[c].addOptions({projection:d},!0);if($.isArray(this.map.layers[c].features))for(a=0;a<this.map.layers[c].features.length;a++)this.map.layers[c].features[a].geometry.transform(b,
d);this.map.layers[c].redraw()}this.map.updateSize()}}}})(window.M);
(function(c,e){e.Util={};e.Util.Geohash={BITS:[16,8,4,2,1],BASE32:"0123456789bcdefghjkmnpqrstuvwxyz",refineInterval:function(a,b,d){b&d?a[0]=(a[0]+a[1])/2:a[1]=(a[0]+a[1])/2},decode:function(a){var b,d,c,e,h=1,j=[],k=[];j[0]=-90;j[1]=90;k[0]=-180;k[1]=180;a=a.replace("#","");for(c=0;c<a.length;c++){b=a.charAt(c);b=this.BASE32.indexOf(b);for(e=0;5>e;e++)d=this.BITS[e],h?this.refineInterval(k,b,d):this.refineInterval(j,b,d),h=!h}j[2]=(j[0]+j[1])/2;k[2]=(k[0]+k[1])/2;return new OpenLayers.LonLat(k[1],
j[1])},encode:function(a){var b,d=1,c=[],e=[],h=0,j=0,k="";c[0]=-90;c[1]=90;e[0]=-180;for(e[1]=180;12>k.length;)d?(b=(e[0]+e[1])/2,a.lon>b?(j|=this.BITS[h],e[0]=b):e[1]=b):(b=(c[0]+c[1])/2,a.lat>b?(j|=this.BITS[h],c[0]=b):c[1]=b),d=!d,4>h?h++:(k+=this.BASE32.charAt(j),j=h=0);return"#"+k}};e.Util.Feature={getIcon:function(a){var b,d;if(a){if(a.attributes.icon)return a.attributes.icon;if(a.attributes.thumbnail)return a.attributes.thumbnail;if(a.attributes.quicklook)return a.attributes.quicklook;if(a.attributes.imageUrl)return a.attributes.imageUrl;
if(a.layer&&(b=a.layer.styleMap.styles["default"],d=a.style||b.defaultStyle,d.externalGraphic))return e.Util.KML.resolveStyleAttribute(a,b,d.externalGraphic);if(a.geometry)switch(a.geometry.CLASS_NAME.replace("OpenLayers.Geometry.","")){case "MultiPolygon":case "Polygon":return c.Util.getImgUrl("polygon.png");case "MultiLineString":case "LineString":return c.Util.getImgUrl("line.png");case "MultiPoint":case "Point":return c.Util.getImgUrl("point.png")}}},getTitle:function(a){var b;if(!a)return null;
if(a.cluster&&0<a.cluster.length)return c.Util._(a.layer.name)+": "+a.cluster.length+" "+c.Util._("entities");if(a.layer&&a.layer._M.layerDescription.featureInfo&&a.layer._M.layerDescription.featureInfo.title)return a.layer._M.layerDescription.featureInfo.title.replace(/\$+([^\$])+\$/g,function(b){b=b.replace(/[\$\$]/g,"");return e.Util.Feature.getValue(a,b,a.attributes[b])});for(b in{name:1,title:1,identifier:1})if(a.attributes[b])return e.Util.Feature.getValue(a,b,a.attributes[b]);return a.fid?
e.Util.Feature.getValue(a,"identifier",a.fid):a.id||""},getValue:function(a,b,d){var c;if(!a||!b)return d;if(a.layer&&a.layer._M.layerDescription.hasOwnProperty("featureInfo"))for(c in a=a.layer._M.layerDescription.featureInfo.keys||[],a)if(b===c){if($.isFunction(a[c].transform))return a[c].transform(d);break}return d},translate:function(a,b){var d,f;if(!b||!a)return c.Util._(a);if(b.layer._M.layerDescription.hasOwnProperty("featureInfo"))for(d in f=b.layer._M.layerDescription.featureInfo.keys||[],
f)if(a===d){if(f[d].hasOwnProperty("v"))return c.Util._(f[d].v);break}return(d=b.layer._M.searchContext)&&d.connector?c.Util._("string"===typeof d.connector.metadataTranslator[a]?d.connector.metadataTranslator[a]:a):c.Util._(a)},toGeo:function(a,b){b=b||{};switch(e.Util.getGeoType(b.mimeType)){case "GML":return e.Util.GML.featureToGML(a,b.schema);case "WKT":return this.toWKT(a);default:return null}},toWKT:function(a){return a&&a.geometry?c.Map.Util.p2d(a.geometry.clone()).toString():""},zoomOn:function(a,
b){$.isArray(a)||(a=[a]);"boolean"!==$.type(b)&&(b=!0);var d,f,e=new OpenLayers.Bounds;d=0;for(f=a.length;d<f;d++)e.extend(a[d].geometry.getBounds());c.Map.zoomTo(e,b)}};e.Util.getGeoBounds=function(a){if(!a)return null;"string"===typeof a&&(a={bounds:a,srs:"EPSG:4326"});if(!a.bounds)return null;var b;b=[];var d=a.srs,f=a.crs||"EPSG:4326";$.isArray(a.bounds)?a=a.bounds:(a=a.bounds.split(","),a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]),a[3]=parseFloat(a[3]));"EPSG:4326"===d?(b[0]=
Math.max(-180,a[0]),b[1]=Math.max(-90,a[1]),b[2]=Math.min(180,a[2]),b[3]=Math.min(90,a[3]),a=b):"EPSG:4326"===f&&(b[0]=Math.max(-180,a[1]),b[1]=Math.max(-90,a[0]),b[2]=Math.min(180,a[3]),b[3]=Math.min(90,a[2]),a=b);b=new OpenLayers.Bounds(a[0],a[1],a[2],a[3]);return"EPSG:4326"===d||"EPSG:4326"===f?b:c.Map.Util.p2d(b)};e.Util.getProjectedBounds=function(a){if(!a)return null;"string"===typeof a&&(a={bounds:a,srs:"EPSG:4326"});if(!a.bounds)return null;var b=0,d=a.srs,c=a.crs;$.isArray(a.bounds)?a=a.bounds:
(a=a.bounds.split(","),a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]),a[3]=parseFloat(a[3]));if("EPSG:4326"===d){if(-180===a[0]||-90===a[1]||180===a[2]||90===a[3])b=1;b=e.Util.d2p(new OpenLayers.Bounds(a[0]+b,a[1]+b,a[2]-b,a[3]-b))}else if("EPSG:4326"===c){if(-180===a[0]||-90===a[1]||180===a[2]||90===a[3])b=1;b=e.Util.d2p(new OpenLayers.Bounds(a[1]+b,a[0]+b,a[3]-b,a[2]-b))}else b=new OpenLayers.Bounds(a[0],a[1],a[2],a[3]);return b};e.Util.getGeoType=function(a){if(!a)return null;
var b=[];b["text/xml; subtype=gml/3.1.1"]="GML";b["application/gml+xml"]="GML";b["text/gml"]="GML";b["application/geo+json"]="JSON";b["application/geojson"]="JSON";b["application/wkt"]="WKT";b["application/x-ogc-wms"]="WMS";return b[a.toLowerCase()]};e.Util.convert=function(a){if(a&&a.input instanceof OpenLayers.Bounds){var b,d,c,e;e=a.precision||-1;var h=a.hasOwnProperty("limit")?a.limit:!1;-1!==e?(b=a.input.left.toFixed(e),c=a.input.right.toFixed(e),d=a.input.bottom.toFixed(e),e=a.input.top.toFixed(e)):
(b=a.input.left,c=a.input.right,d=a.input.bottom,e=a.input.top);h&&(b=Math.max(b,-180),c=Math.min(c,180),d=Math.max(d,-90),e=Math.min(e,90));if("WKT"===a.format)return"POLYGON(("+b+" "+d+","+b+" "+e+","+c+" "+e+","+c+" "+d+","+b+" "+d+"))";if("EXTENT"===a.format)return b+","+d+","+c+","+e}return""};e.Util.getControlById=function(a){return e.map.getControlsBy("id",a)[0]};e.Util.getFeatures=function(a,b,d){var f,e,h,j,k,m=[],b=b||{};if(a&&a.features){e=0;for(j=a.features.length;e<j;e++)if(f=a.features[e],
f.cluster&&!d){h=0;for(k=f.cluster.length;h<k;h++)f.cluster[h].layer=f.cluster[h].layer||a,m.push(b.toDisplayProjection?f.cluster[h].clone():f.cluster[h])}else m.push(b.toDisplayProjection?f.clone():f)}if(b.toDisplayProjection){e=0;for(j=m.length;e<j;e++)if(m.components){h=0;for(k=m.components.length;h<k;h++)c.Map.Util.p2d(m.components[h].geometry)}else c.Map.Util.p2d(m[e].geometry)}b.attribute&&m.sort(function(a,d){var c,f;if(!a.hasOwnProperty("attributes")||!d.hasOwnProperty("attributes"))return 0;
"d"===b.order?(c=d.attributes[b.attribute],f=a.attributes[b.attribute]):(c=a.attributes[b.attribute],f=d.attributes[b.attribute]);"n"===b.type?(c=parseFloat(c),f=parseFloat(f)):"t"===b.type&&(c=c.toLowerCase(),f=f.toLowerCase());return c<f?-1:c>f?1:0});return m};e.Util.getFeature=function(a,b){if(!a||!b||!a.features)return null;for(var d=e.Util.getFeatures(a),c=0,g=d.length;c<g;c++)if(d[c].fid===b)return d[c];return null};e.Util.getFormattedLonLat=function(a,b){b||(b="dms");return-1!==b.indexOf("h")?
e.Util.getFormattedCoordinate(a.lon,"lon",b)+"&nbsp;::&nbsp;"+e.Util.getFormattedCoordinate(a.lat,"lat",b):e.Util.getFormattedCoordinate(a.lat,"lat",b)+"&nbsp;::&nbsp;"+e.Util.getFormattedCoordinate(a.lon,"lon",b)};e.Util.getFormattedCoordinate=function(a,b,d){var c,e,h,j="",k="\u00b0";d||(d="dms");"lon"===b?(a=(a+540)%360-180,h=0>a?"W":"E"):(a=(a+270)%180-90,h=0>a?"S":"N");-1!==d.indexOf("h")&&("lon"===b&&(a=24*((360-a)%360)/360,k="h"),h="",j=0>a?"-":"+");a=Math.abs(a);c=a|0;e=a=(a-c)/(1/60);a|=
0;e=Math.round(10*((e-a)/(1/60)))/10;60<=e&&(e-=60,a+=1,60<=a&&(a-=60,c+=1));b=("lat"===b?j:"")+(10>c?"0":"")+c+k;1<=d.indexOf("m")&&(b+=(10>a?"0":"")+a+"'",1<=d.indexOf("ms")&&(b+=(10>e?"0":"")+e+'"'));return b+h};e.Util.getLayerByMID=function(a){if(!a||""===a)return null;for(var b=0,d=e.map.layers.length;b<d;b++){var c=e.map.layers[b];if(c._M&&c._M.MID===a)return c}return null};e.Util.isRaster=function(a){return!a||!a._M?!1:a._M.isRaster};e.Util.layerIsEmpty=function(a){if(!a||!a.features||0===
a.features.length)return!0;var b=!0,d;for(d=a.features.length;d--;)if(a.features[d].geometry){b=!1;break}return b};e.Util.d2p=function(a){return a.transform(e.pc,e.map.getProjectionObject())};e.Util.p2d=function(a){return a.transform(e.map.getProjectionObject(),e.pc)};e.Util.setLayerOnTop=function(a){a&&e.map.setLayerIndex(a,e.map.layers.length)};e.Util.setVisibility=function(a,b){a.setVisibility(b);e.events.trigger("visibilitychanged",a)};e.Util.switchVisibility=function(a){(a=e.Util.getLayerByMID(a))&&
e.Util.setVisibility(a,!a.getVisibility())};e.Util.updateIndex=function(a){var b,d,c=e.map.getLayerIndex(a);if(!a||!a.features)return!1;for(b=e.map.layers.length;b--;)if(d=e.map.layers[b],a.id!==d.id&&a.features[0]&&a.features[0].geometry){if(!d.features){c=e.map.getLayerIndex(d);break}if("OpenLayers.Geometry.Point"===a.features[0].geometry.CLASS_NAME)break;if(d.features[0]&&d.features[0].geometry){if("OpenLayers.Geometry.Polygon"===d.features[0].geometry.CLASS_NAME){c=e.map.getLayerIndex(d);break}if("OpenLayers.Geometry.Line"===
a.features[0].geometry.CLASS_NAME&&"OpenLayers.Geometry.Line"===d.features[0].geometry.CLASS_NAME){c=e.map.getLayerIndex(d);break}}}e.map.getLayerIndex(a)!==c&&e.map.setLayerIndex(a,c+1);return!0};e.Util.zoomOn=function(a,b){var d;if(!a||!a._M)return!1;d=a.getDataExtent()||a._M.bounds;return b&&d||a._M.initialized&&d&&!c.Map.map.getExtent().intersectsBounds(d,!0)?(c.Map.zoomTo(d),!0):!1};e.Util.posListToGeoJsonGeometry=function(a){var b=[],d,c;if(a){c=a.split(" ");a=0;for(d=c.length;a<d;a+=2)b.push("["+
c[a]+","+c[a+1]+"]")}return b.join(",")};e.Util.elasticResultToGeoJSON=function(a){var b,d,c,e,h;d={};var j=[],k={point:"Point",linestring:"LineString",polygon:"Polygon"};b=0;for(h=a.hits.hits.length;b<h;b++)e=a.hits.hits[b],d=e._id,c=e._type,e=e._source,e.shape.type=k[e.shape.type]||e.shape.type,d={id:d,type:c},$.extend(d,e.tags),j.push({type:"Feature",geometry:e.shape,properties:d});return{type:"FeatureCollection",features:j}}})(window.M,window.M.Map);
(function(c,e){e.Util=e.Util||{};e.Util.GML={namespaces:'xmlns:gml="http://www.opengis.net/gml"',featureToGML:function(a,b){var d,c,g="";if(a&&a.geometry)if(d=a.geometry.CLASS_NAME,"OpenLayers.Geometry.Point"===d)g=this.geometryPointToGML(a.geometry);else if("OpenLayers.Geometry.MultiPoint"!==d)if("OpenLayers.Geometry.LineString"===d)g=this.geometryLineStringToGML(a.geometry);else if("OpenLayers.Geometry.MultiLineString"===d){if(a.geometry.components){d=0;for(c=a.geometry.components.length;d<c;d++)g+=
this.geometryLineStringToGML(a.geometry.components[d])}}else{if("OpenLayers.Geometry.Polygon"===d)return this.geometryPolygonToGML(a.geometry);if("OpenLayers.Geometry.MultiPolygon"===d&&a.geometry.components){d=0;for(c=a.geometry.components.length;d<c;d++)g+=this.geometryPolygonToGML(a.geometry.components[d])}}return"http://schemas.opengis.net/gml/3.1.1/base/feature.xsd"===b?"<gml:FeatureCollection "+e.Util.GML.namespaces+" ><gml:featureMember><gml:GeometryPropertyType>"+g+"</gml:GeometryPropertyType></gml:featureMember></gml:FeatureCollection>":
g},geometryPointToGML:function(a){a=e.Util.p2d(new OpenLayers.LonLat(a.x,a.y));return"<gml:Point "+e.Util.GML.namespaces+' srsName="'+e.map.displayProjection.projCode+'"><gml:pos>'+a.lon+" "+a.lat+"</gml:pos></gml:Point>"},geometryLineStringToGML:function(a){var b,d="";if(a.components)for(var f=0,g=a.components.length;f<g;f++)b=a.components[f],b=c.Map.Util.p2d(new OpenLayers.LonLat(b.x,b.y)),d+=b.lon+" "+b.lat+" ";return"<gml:LineString "+e.Util.GML.namespaces+' srsName="'+e.map.displayProjection.projCode+
'"><gml:posList>'+d.substring(0,d.length-1)+"</gml:posList></gml:LineString>"},geometryPolygonToGML:function(a){var b,d,f="";if(a.components)for(var g=0,h=a.components.length;g<h;g++){d=a.components[g];for(var j=0,k=d.components.length;j<k;j++)b=d.components[j],b=c.Map.Util.p2d(new OpenLayers.LonLat(b.x,b.y)),f+=b.lon+" "+b.lat+" "}return"<gml:Polygon "+e.Util.GML.namespaces+' srsName="'+e.map.displayProjection.projCode+'"><gml:exterior><gml:LinearRing><gml:posList>'+f.substring(0,f.length-1)+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"},
toGeoJSON:function(a,b){var d={};if(a instanceof jQuery)switch(c.Util.stripNS(a[0].nodeName)){case "Point":d=this.pointToGeoJSON(a,b);break;case "LineString":d=this.lineStringToGeoJSON(a,b);break;case "Polygon":d=this.polygonToGeoJSON(a,b);break;case "MultiPolygon":d=this.multiPolygonToGeoJSON(a,b)}return d},pointToGeoJSON:function(a,b){b=b||{identifier:c.Util.getId()};return JSON.parse(c.Util.parseTemplate(this.geoJSONTemplate,{geometry:'{"type":"Point","coordinates":'+e.Util.posListToGeoJsonGeometry(a.children().text())+
"}",properties:JSON.stringify(b)}))},lineStringToGeoJSON:function(a,b){b=b||{identifier:c.Util.getId()};return JSON.parse(c.Util.parseTemplate(this.geoJSONTemplate,{geometry:'{"type":"LineString","coordinates":['+e.Util.posListToGeoJsonGeometry(a.children().text())+"]}",properties:JSON.stringify(b)}))},polygonToGeoJSON:function(a,b){var d=[],b=b||{identifier:c.Util.getId()};a.children().each(function(){$(this).children().each(function(){d.push("["+e.Util.posListToGeoJsonGeometry($(this).children().text())+
"]")})});return JSON.parse(c.Util.parseTemplate(this.geoJSONTemplate,{geometry:'{"type":"Polygon","coordinates":['+d.join(",")+"]}",properties:JSON.stringify(b)}))},multiPolygonToGeoJSON:function(a,b){var d=[],f=[],b=b||{identifier:c.Util.getId()};a.children().each(function(){$(this).children().each(function(){f=[];$(this).children().each(function(){f.push("["+e.Util.posListToGeoJsonGeometry($(this).children().text())+"]")});d.push("["+f.join(",")+"]")})});return JSON.parse(c.Util.parseTemplate(this.geoJSONTemplate,
{geometry:'{"type":"MultiPolygon","coordinates":['+d.join(",")+"]}",properties:JSON.stringify(b)}))},geoJSONTemplate:'{"type":"FeatureCollection","features":[{"type":"Feature","geometry":$geometry$,"properties":$properties$}]}'}})(window.M,window.M.Map);
(function(c,e){e.Util=e.Util||{};e.Util.KML={layerToKML:function(a,b){if(!a)return!1;if(a._M&&a._M.kml)return a._M.kml;var b=b||{},d="",f,e;if("OpenLayers.Layer.Image"===a.CLASS_NAME)d+=this.imageToKML(a);else if("OpenLayers.Layer.WMS"===a.CLASS_NAME&&b.synchronizeWMS)d+=this.wmsToKML(a);else if("OpenLayers.Layer.Vector"===a.CLASS_NAME){var h,j=[];f=0;for(e=a.features.length;f<e;f++)if(h=a.features[f],h.cluster)for(var k=0,m=h.cluster.length;k<m;k++)h.cluster[k].geometry&&j.push(h.cluster[k]);else h.geometry&&
j.push(h);if(0<j.length){b.color&&(d+='<Style id="normalState"><IconStyle><scale>1.1</scale><Icon><href>'+c.Util.getImgUrl("ylw-pushpin.png")+'</href></Icon><hotSpot x="20" y="2" xunits="pixels" yunits="pixels"/></IconStyle><PolyStyle><color>'+this.color2KML(b.color,b.opacity)+"</color></PolyStyle></Style>");f=0;for(e=j.length;f<e;f++)d+=this.featureToKML(j[f],b)}}""!==d&&(d='<?xml version="1.0" encoding="UTF-8"?><kml xmlns="http://www.opengis.net/kml/2.2" xmlns:kml="http://www.opengis.net/kml/2.2"><Document><name>'+
this.encode(c.Util._(a.name))+"</name><description></description>"+d+"</Document></kml>");return d},featureToKML:function(a,b){var d,f,e,h="",j="",b=b||{};if(a&&a.geometry){var k=null,m=a.geometry.CLASS_NAME;for(d in a.attributes)"name"===d?f=a.attributes[d]:"description"===d?j+=a.attributes[d]+"<br/>":(e=a.attributes[d],j="string"===typeof e&&c.Util.isUrl(e)?"thumbnail"===d?j+('<img src="'+e+'" class="center" width="250"/><br/>'):j+('<a target="_blank" href="'+e+'">'+d+"</a><br/>"):j+(d+" : "+e+
"<br/>")),"ele"===d&&(k=a.attributes[d],$.isNumeric(k)||(k=null));if(void 0===f||""===f)f=a.id;d="<name><![CDATA["+f+']]\></name><description><![CDATA[<table border="0" cellpadding="0" cellspacing="0" width="300" align="left"><tr><td>'+j+"</td></tr></table>]]\></description>";if("OpenLayers.Geometry.Point"===m)f=c.Map.Util.p2d(new OpenLayers.LonLat(a.geometry.x,a.geometry.y)),h="<Point><coordinates>"+f.lon+","+f.lat+(k?","+k:"")+"</coordinates></Point>";else if("OpenLayers.Geometry.MultiPoint"===
m){if(a.geometry.components){e=0;for(j=a.geometry.components.length;e<j;e++)f=a.geometry.components[e],f=c.Map.Util.p2d(new OpenLayers.LonLat(f.x,f.y)),h+="<Point><coordinates>"+f.lon+","+f.lat+(k?","+k:"")+"</coordinates></Point>"}}else if("OpenLayers.Geometry.LineString"===m){if(a.geometry.components){e=0;for(j=a.geometry.components.length;e<j;e++)f=a.geometry.components[e],f=c.Map.Util.p2d(new OpenLayers.LonLat(f.x,f.y)),h+=f.lon+","+f.lat+(k?","+k:"")+" "}h="<LineString><coordinates>"+h.substring(0,
h.length-1)+"</coordinates></LineString>"}else if("OpenLayers.Geometry.Polygon"===m){var n,p;if(a.geometry.components){e=0;for(j=a.geometry.components.length;e<j;e++){p=a.geometry.components[e];m=0;for(n=p.components.length;m<n;m++)f=p.components[m],f=c.Map.Util.p2d(new OpenLayers.LonLat(f.x,f.y)),h+=f.lon+","+f.lat+(k?","+k:"")+" "}}h="<Polygon><outerBoundaryIs><LinearRing><coordinates>"+h.substring(0,h.length-1)+"</coordinates></LinearRing></outerBoundaryIs></Polygon>"}}return""!==h?"<Placemark>"+
d+(b.color?"<styleUrl>#normalState</styleUrl>":this.featureToKMLStyle(a))+h+"</Placemark>":h},featureToKMLStyle:function(a){var b="",d,f,e;a&&a.layer&&(e=a.geometry.CLASS_NAME,d=a.layer.styleMap.styles["default"],f=a.style||d.defaultStyle,"OpenLayers.Geometry.Point"===e?(b=f.externalGraphic?this.resolveStyleAttribute(a,d,f.externalGraphic):c.Util.getImgUrl("ylw-pushpin.png"),"http:"!==b.substr(0,5)&&"/"!==b.substr(0,1)&&(b=c.Config.general.rootUrl+"/"+b),b="<Style><IconStyle><Icon><href>"+this.encode(c.Util.getAbsoluteUrl(b))+
"</href></Icon></IconStyle></Style>"):"OpenLayers.Geometry.LineString"===e?b="<LineStyle><color>"+this.color2KML(this.resolveStyleAttribute(a,d,f.strokeColor),1)+"</color><width>"+(f.strokeWidth||1)+"</width></LineStyle>":"OpenLayers.Geometry.Polygon"===e&&(b="<Style><PolyStyle><color>"+this.color2KML(this.resolveStyleAttribute(a,d,f.fillColor),f.fillOpacity)+"</color></PolyStyle></Style>"));return b},resolveStyleAttribute:function(a,b,d){var c=d;-1!==d.indexOf("${")&&(d=d.substring(2,d.length-1),
c=b.context&&$.isFunction(b.context[d])?b.context[d](a):a.attributes[d]);return c},color2KML:function(a,b){b=Math.round(16*(b||0.4)).toString(16);a=a?a.replace(/#/,"").toLowerCase():"ee9900";return b+b+a.substring(4,6)+a.substring(2,4)+a.substring(0,2)},imageToKML:function(a){var b=a._M&&a._M.bounds?c.Map.Util.p2d(a._M.bounds.clone()):c.Map.Util.p2d(a.bounds.clone());return a.url?"<GroundOverlay><name>"+this.encode(c.Util._(a.name))+"</name><description></description><drawOrder>0</drawOrder><Icon><href>"+
this.encode(a.url)+"</href></Icon><LatLonBox><north>"+b.top+"</north><south>"+b.bottom+"</south><east>"+b.left+"</east><west>"+b.right+"</west><rotation>0</rotation></LatLonBox></GroundOverlay>":""},wmsToKML:function(a){var b=e.Util.p2d(e.map.getExtent()),d=a._M.layerDescription.version||"1.1.0",d=a.url+"WIDTH=512&HEIGHT=256&FORMAT=image/png&TRANSPARENT=true&SERVICE=WMS&REQUEST=GetMap&LAYERS="+a._M.layerDescription.layers+"&VERSION="+d+("1.3.0"===d?"&CRS=EPSG:4326&BBOX="+b.bottom+","+b.left+","+b.top+
","+b.right:"&SRS=EPSG:4326&BBOX="+b.left+","+b.bottom+","+b.right+","+b.top);return a.url?"<GroundOverlay><name>"+this.encode(c.Util._(a.name))+"</name><description></description><drawOrder>0</drawOrder><Icon><href>"+this.encode(d)+"</href></Icon><LatLonBox><north>"+b.top+"</north><south>"+b.bottom+"</south><east>"+b.left+"</east><west>"+b.right+"</west><rotation>0</rotation></LatLonBox></GroundOverlay>":""},encode:function(a){return a.replace(/\&/g,"&amp;")}}})(window.M,window.M.Map);
(function(c){c.Map.Events=function(e){if(e.Events._o)return e.Events._o;this.map=e.map;this.events={featureselected:[],layersend:[],moveend:[],resizeend:[],visibilitychanged:[],mapclicked:[]};this.register=function(a,b,d){var c=a;if("loadstart"===a||"loadend"===a)c="layersend";this.events[c]&&this.events[c].push({scope:b,handler:d})};this.unRegister=function(a){var b,d,c,e;for(c in this.events){b=this.events[c];d=0;for(e=b.length;d<e;d++)if(b[d].scope===a){b.splice(d,1);break}}};this.trigger=function(a,
b){var d,f,g;if("layersend"===a){if(b){if(b.layer&&b.layer.features){d=0;var h=b.layer.features;f=0;for(g=h.length;f<g;f++)d+=h[f].cluster?h[f].cluster.length:1;b.layer._M.count=d}f=0;for(g=this.events.layersend.length;f<g;f++)d=this.events.layersend[f],b.layer&&"features"===b.action&&c.Map.Util.updateIndex(b.layer),d&&d.handler(b.action,b.layer,d.scope);if(!c.isLoaded){h=!1;f=0;for(g=this.map.layers.length;f<g;f++)if(d=this.map.layers[f],d.hasOwnProperty("_M")&&!d._M.MLayer&&!d._tobedestroyed&&!d._M.isLoaded){h=
!0;break}h||(c.isLoaded=!0,this.map.restrictedExtent?this.map.zoomToExtent(this.map.restrictedExtent):e.setCenter(e.Util.d2p(new OpenLayers.LonLat(e.initialLocation.lon,e.initialLocation.lat)),e.initialLocation.zoom,!0))}}}else if("loadstart"===a)b&&(b._M.isLoaded=!1,this.trigger("layersend",{action:"update",layer:b}));else if("loadend"===a)b&&(b._M.isLoaded=!0,this.trigger("layersend",{action:"update",layer:b}));else if("moveend"===a){f=0;for(g=this.events.moveend.length;f<g;f++)d=this.events.moveend[f],
d.handler(this.map,d.scope)}else if("resizeend"===a){f=0;for(g=this.events.resizeend.length;f<g;f++)d=this.events.resizeend[f],d.handler(d.scope)}else{f=0;for(g=this.events[a].length;f<g;f++)d=this.events[a][f],d.handler(b,d.scope)}};e.Events._o=this;return this}})(window.M);
(function(c){c.Map.LayersGroup=function(e,a,b){this.CLASS_NAME="M.Map.LayersGroup";this.map=e;this.name=a;this.id=c.Util.getId();this.icon=b||c.Util.getImgUrl("group.png");this.isLoaded=function(){for(var a=this.layers.length;a--;)if(!this.layers[a]._M.isLoaded)return!1;return!0};this.layers=[];this.layersManagerMenuItems=[];this.visibility=!0;this.add=function(a){for(var b=this.layers.length;b--;)if(this.layers[b]._M.MID===a._M.MID)return!1;this.layers.push(a);return!0};this.remove=function(a){for(var b=
this.layers.length,c=0;c<b;c++)if(this.layers[c]._M.MID===a._M.MID){this.layers.splice(c,1);break}return!0};this.zoomOn=function(){for(var a=null,b=null,c=this.layers.length;c--;)if((a=this.layers[c].getDataExtent())||(a=this.layers[c]._M.bounds))b?b.extend(a):b=a.clone();b&&this.map.zoomTo(b)};this.setVisibility=function(a){for(var b=this.layers.length;b--;)this.map.setVisibility(this.layers[b],a);this.visibility=a};this.getVisibility=function(){return this.visibility};this.getLayersManagerMenuItems=
function(){return this.layersManagerMenuItems}}})(window.M);
(function(c){c.Map.FeatureInfo=function(e){if(c.Map.FeatureInfo._o)return c.Map.FeatureInfo._o;this.hilited=this.selected=null;this.dimension={w:100,h:50};this.bypassCallback=null;this.init=function(){var a=this;a._p=new c.Popup({modal:!1,generic:!1,hideOnClose:!0,noHeader:!0,autoSize:!0,classes:"fipopup apo",followMap:!0,centered:!1,onClose:function(){a.clear()}});a._mip=new c.Popup({modal:!1,generic:!1,hideOnClose:!0,noHeader:!0,noFooter:!1,scope:a,classes:"mip",centered:!1,autoSize:!0,zIndex:3E4,
footer:'<div class="tools"></div>',onClose:function(){a.clear()}});a._mip.$b.addClass("padded");a.sidePanelItem=c.sidePanel.add({id:c.Util.getId()});c.Map.events.register("layersend",a,function(a,c,f){"remove"===a&&f.selected&&(f.selected.layer&&f.selected.layer.id===c.id)&&f.unselect(f.selected);return!0});c.Map.events.register("visibilitychanged",a,function(a,c){if(c.selected&&c.selected.layer===a)if(a.getVisibility()){var f=a._M.layerDescription.featureInfo;(!f||!f.noMenu)&&c.getPopup(a).show()}else c.hide()});
return a};this.getPopup=function(a){return!a?this._p:a._M.microInfoTemplate.enable?this._mip:this._p};this.clear=function(){var a=c.Map.Util.getControlById("__CONTROL_SELECT__");if(this.selected)try{a.unselect(this.selected)}catch(b){a.unselectAll()}else a.unselectAll();this.unselect(null)};this.setContent=function(a){var b,d;if(!a)return!1;b=a.layer._M.microInfoTemplate;b.enable?(d=c.Map.Util.Feature.getTitle(a),this._mip.$b.html(b.body?c.Util.parseTemplate(b.body,a.attributes):'<h2 class="shorten_30" title="'+
d+'">'+d+"</h2>"),c.Util.findAndShorten(this._mip.$d,!0),b=$(".tools",this._mip.$f)):(this._p.$b.html('<span class="title" style="white-space:nowrap;">'+c.Map.Util.Feature.getTitle(a)+'</span><br/><span class="tools"></span>'),b=$(".tools",this._p.$b));this.setTools(a,b);c.Map.$featureHilite.empty().hide();return!0};this.setTools=function(a,b){var d,f,e,h,j,k=this,m=[],n=a.layer._M.layerDescription.featureInfo;b.empty();m.push({id:c.Util.getId(),icon:"info.png",title:"Info",tt:"More info",callback:function(a,
b){k.showInfo(b);return!1}});m.push({id:c.Util.getId(),icon:"center.png",title:"Zoom",tt:"Zoom on feature",callback:function(){k.zoomOn();return!1}});a.layer.displayInLayerSwitcher&&m.push({id:c.Util.getId(),icon:"hide.png",title:"Hide the parent layer",callback:function(a,b){c.Map.Util.setVisibility(b.layer,!1)}});var p=!1;a.attributes.hasOwnProperty("services")?(f=a.attributes.services.browse,p=a.attributes.services.download?!0:!1):a.attributes.quicklook&&-1!==a.attributes.quicklook.toLowerCase().indexOf("service=wms")&&
(f={});if(a.attributes.hasOwnProperty("atom")&&$.isArray(a.attributes.atom.links)){e=0;for(h=a.attributes.atom.links.length;e<h;e++)if("enclosure"===a.attributes.atom.links[e].rel){p=!0;break}}p&&m.push({id:c.Util.getId(),icon:"download.png",title:"Download",tt:"Download feature",sla:function(b,c){if(c&&c.attributes){var d={};if(c.attributes.hasOwnProperty("services"))d=c.attributes.services.download;else if(c.attributes.hasOwnProperty("atom")&&$.isArray(c.attributes.atom.links))for(var f=0,e=c.attributes.atom.links.length;f<
e;f++)if("enclosure"===c.attributes.atom.links[f].rel){d.url=a.attributes.atom.links[f].href;break}b.attr("href",d.url);d.mimeType&&"text/html"===d.mimeType.toLowerCase()&&b.attr("target","_blank")}},callback:function(){return!0}});f&&m.push({id:c.Util.getId(),icon:"add.png",tt:f.title||"Add to map",title:"Add",callback:function(a,b){var d;b.attributes.hasOwnProperty("services")&&b.attributes.services.browse?d=c.Map.addLayer(b.attributes.services.browse.layer):b.attributes.hasOwnProperty("quicklook")&&
-1!==b.attributes.quicklook.toLowerCase().indexOf("service=wms")&&c.Map.layerTypes.WMS&&(d=c.Map.layerTypes.WMS.getLayerDescriptionFromUrl(b.attributes.quicklook),d.type="WMS",d.srs="EPSG:3857",d=c.Map.addLayer(d));d&&c.Map.zoomTo(d.getDataExtent()||d._M.bounds);return!1}});for(d in c.plugins)if((e=c.plugins[d])&&$.isFunction(e.getFeatureActions))if(f=e.getFeatureActions(a))if(f instanceof Array){e=0;for(h=f.length;e<h;e++)m.push(f[e])}else m.push(f);n&&n.action&&$.isFunction(n.action.callback)&&
m.push({id:c.Util.getId(),icon:n.action.icon,title:n.action.title,tt:n.action.tt,callback:function(a,b){n.action.callback(a,b);return!1}});a.layer._M.searchContext&&(j=a.layer._M.searchContext.connector)&&j.action&&m.push({id:c.Util.getId(),icon:j.action.icon,title:j.action.title,tt:j.action.tt,sla:$.isFunction(j.action.sla)?j.action.sla:null,callback:function(a,b){return $.isFunction(j.action.callback)&&"#"===a.attr("href")?(j.action.callback(a,b),!1):!0}});e=0;for(h=m.length;e<h;e++)d=m[e],b.append('<a class="item image" jtitle="'+
c.Util._(d.tt||d.title)+'" id="'+d.id+'"><img class="middle" src="'+c.Util.getImgUrl(d.icon)+'"/></a>'),f=$("#"+d.id),c.tooltip.add(f,"n",10),function(a,b,c){a.click(function(){return b.callback(b,c)})}(f,d,a),d.sla&&d.sla(f,a)};this.select=function(a,b){var d,f,e;this._tse=(new Date).getTime();if(a.cluster&&(e=a.cluster.length,0<e)){a.layer||(a.layer=a.cluster[0].layer);if(a.layer&&"Polygon"===a.layer._M.clusterType)this.selected=a,this.showCluster(a.cluster);else{f=a.cluster[0].geometry.getBounds().clone();
for(d=1;d<e;d++)f.extend(a.cluster[d].geometry.getBounds());c.Map.map.zoomToExtent(f)}this.hide();return!1}this._p.setMapXY(this._triggered?c.Map.map.getCenter():"OpenLayers.Geometry.Point"===a.geometry.CLASS_NAME?a.geometry.getBounds().getCenterLonLat():c.Map.map.getLonLatFromPixel(c.Map.mousePosition));if(b){this._triggered=!0;d=c.Map.Util.getControlById("__CONTROL_SELECT__");if(this.selected)try{d.unselect(this.selected)}catch(h){this.selected=null}return d.select(a)}this._triggered||c.Map.events.trigger("featureselected",
a);this._triggered=!1;c.menu.hide();this.selected=a;if($.isFunction(this.bypassCallback)){this.bypassCallback(a);try{d.unselect(this.selected)}catch(j){this.selected=null}return!0}if(e=c.Map.layerTypes[a.layer._M.layerDescription.type].resolvedUrlAttributeName)d=c.Map.Util.Feature.getTitle(a),e=c.southPanel.add({id:c.Util.crc32(d+a.layer._M.layerDescription.type),tt:d,title:d,unremovable:!1,html:'<iframe class="frame" src="'+a.attributes[e]+'" width="100%" height="100%"></iframe>',onclose:function(){a&&
a.layer&&c.Map.Util.getControlById("__CONTROL_SELECT__").unselect(a);c.activity.hide()}}),c.southPanel.show(e),c.activity.show(),$(".frame",e.$d).load(function(){c.activity.hide()});else{e=a.layer._M.layerDescription.featureInfo;this.hide();if(!e||!e.noMenu)this.setContent(a),this.getPopup(a.layer).show();if(e&&$.isFunction(e.onSelect))e.onSelect(a)}return!0};this.unselect=function(a){var b=this;b._tun=(new Date).getTime();a&&"Polygon"===a.layer._M.clusterType&&c.sidePanel.hide(b.sidePanelItem);if(a&&
a.layer._M.layerDescription.featureInfo&&$.isFunction(a.layer._M.layerDescription.featureInfo.onUnselect))a.layer._M.layerDescription.featureInfo.onUnselect(a);c.Map.featureInfo.selected=null;c.Map.events.trigger("featureselected",null);setTimeout(function(){0<b._tun-b._tse&&(c.menu.hide(),b.hide())},10)};this.zoomOn=function(){c.Map.featureInfo.selected&&c.Map.featureInfo.selected.geometry&&c.Map.zoomTo(c.Map.featureInfo.selected.geometry.getBounds())};this.hilite=function(a){var b=c.Map.Util.getControlById("__CONTROL_HIGHLITE__");
if(b&&a)try{var d,f,e=c.Map.Util.getFeatures(a.layer);d=0;for(f=e.length;d<f;d++)b.unhighlight(e[d]);this.hilited=a;b.highlight(a)}catch(h){}};this.unhilite=function(a){var b=c.Map.Util.getControlById("__CONTROL_HIGHLITE__");if(b&&a)try{this.hilited=null,b.unhighlight(a)}catch(d){}};this.showInfo=function(a){if(!a)return!1;var b,d,e,g,h,j,k,m;e=!0;d=c.Util.stripTags(c.Map.Util.Feature.getTitle(a));m=a.attributes.quicklook||a.attributes.imageUrl;b=c.Util.$$("#"+c.Util.getId(),$("#mapshup")).addClass("overall").append('<div class="fi"><div class="header"><div class="title"></div></div><div class="body"></div></div>');
c.Util.addClose(b,function(){c.activity.hide();b.remove()});m?($(".body",b).append('<div class="ql" style="float:left;width:49%;"><img src="'+m+'"/></div><div class="info"></div>'),$(".ql img",b).css({"max-width":Math.round(4*$("#mapshup").width()/10),"max-height":Math.round(9*$("#mapshup").height()/10)}),g=new Image,g.src=m,c.activity.show(),$(g).load(function(){c.activity.hide()}).error(function(){c.activity.hide()})):$(".body",b).append('<div class="info"></div>');$(".title",b).attr("title",a.layer.name+
" | "+d).html(d);if((d=c.Map.layerTypes[a.layer._M.layerDescription.type])&&$.isFunction(d.setFeatureInfoBody))d.setFeatureInfoBody(a,$(".info",b)),e=!1;if(e)for(j in $(".info",b).html('<table style="width:'+(m?"45":"95")+'%"></table>'),m=$(".info table",b),a.attributes)if(!("self"===j||"identifier"===j||"icon"===j||"thumbnail"===j||"quicklook"===j||"imageUrl"===j||"modified"===j||"color"===j))if(e=a.attributes[j])if(d=typeof e,"string"===d&&c.Util.isUrl(e))m.append("<tr><td>"+c.Map.Util.Feature.translate(j,
a)+'</td><td>&nbsp;</td><td><a target="_blank" title="'+e+'" href="'+e+'">'+c.Util._("Download")+"</a></td></tr>");else if("object"===d){if("services"!==j)if("atom"===j)e.id&&m.append('<tr><td title="'+c.Util._("identifier")+'">'+c.Util._("identifier")+"</td><td>&nbsp;</td><td>"+e.id+"<td></tr>"),e.updated&&m.append('<tr><td title="'+c.Util._("updated")+'">'+c.Util._("updated")+"</td><td>&nbsp;</td><td>"+e.updated+"<td></tr>");else for(k in e)if("object"===typeof e[k]){if("photos"===k){m.append('<tr><td></td><td>&nbsp;</td><td class="thumbs"><td></tr>');
g=0;for(h=e[k].length;g<h;g++)d=c.Util.getId(),$(".thumbs",m).append('<img href="'+e[k][g].url+'" title="'+e[k][g].name+'" id="'+d+'" src="'+e[k][g].url+'"/>'),function(a){a.click(function(){c.Util.showPopupImage(a.attr("href"),a.attr("title"));return!1})}($("#"+d))}}else d=c.Map.Util.Feature.translate(j,a),m.append('<tr><td title="'+d+'">'+d,"20 &rarr; "+c.Map.Util.Feature.translate(k,a)+"</td><td>&nbsp;</td><td>"+e[k]+"</td></tr>")}else d=c.Map.Util.Feature.translate(j,a),m.append('<tr><td title="'+
d+'">'+d+"</td><td>&nbsp;</td><td>"+c.Map.Util.Feature.getValue(a,j,e)+"</td></tr>");b.show();return!0};this.showCluster=function(a){var b,d,e,g,h,j,k;k=this.sidePanelItem.$d.html('<div class="marged"></div>').children().first();b=0;for(d=a.length;b<d;b++)e=a[b],e.layer&&(g=c.Util.encode(e.id)+"c",h=c.Map.Util.Feature.getIcon(e),j=c.Util.stripTags(c.Map.Util.Feature.getTitle(e)),k.append('<span class="thumbs" jtitle="'+j+'" id="'+g+'">'+(h?"":'<span class="title">'+j+"</span>")+'<img src="'+(h?h:
c.Util.getImgUrl("nodata.png"))+'"></span>'),function(a,b){b.click(function(a){a.preventDefault();a.stopPropagation();return!1});c.tooltip.add(b,"e",10)}(e,$("#"+g)));c.sidePanel.show(this.sidePanelItem)};this.hide=function(){this._p.$d.is(":visible")&&this._p.hide(!0);this._mip.$d.is(":visible")&&this._mip.hide(!0)};c.Map.FeatureInfo._o=this;return this.init(e)}})(window.M);
(function(c){c.Map.LayerDescription=function(e,a){this.obj=e;this.map=a;this.isValid=function(){var a,c,e;if(!this.obj||"object"!==typeof this.obj)return!1;a=this.getLayerType();if(!a)return!1;e=a.mandatories||[];a=0;for(c=e.length;a<c;a++)if(!this.obj.hasOwnProperty([e[a]]))return!1;return!0};this.getLayerType=function(){return!this.map||!this.obj?null:this.map.layerTypes[this.obj.type]};this.get=function(){return this.obj};this.getMID=function(){var a=this.obj,d=this.map.layerTypes[a.type];return a.MID?
a.MID:!d?null:$.isFunction(d.getMID)?d.getMID(a):a.replace&&a.hasOwnProperty("url")?c.Util.crc32(a.type+a.url.split("?")[0]):c.Util.crc32(a.type+(a.title||""))};this.getInfo=function(){var a=[];if(this.obj){var d=this.map.layerTypes[this.obj.type];d&&(a=[["Title",c.Util._(this.obj.title)],["Description",c.Util._(this.obj.description||"No description available")],["Type",c.Util._(this.obj.type)]],this.obj.preview&&a.push(["Preview",this.obj.preview]),$.isFunction(d.getInfo)&&(a=a.concat(d.getInfo(this.obj))))}return a};
this.getStyleMap=function(){var a=null,d=this.obj,e=d.hasOwnProperty("opacity")?d.opacity:0.2;d.hasIconAttribute&&(a="${icon}");a=new OpenLayers.Style(OpenLayers.Util.applyDefaults({pointRadius:a?10:"${scaledSize}",externalGraphic:a,fillOpacity:e,graphicOpacity:1,strokeColor:"#000",strokeWidth:1,label:"${label}",fontSize:"${fontSize}",fontColor:"${fontColor}",fontStrokeColor:"${fontColor}",fontStrokeWidth:0,fillColor:"${color}"},OpenLayers.Feature.Vector.style["default"]),{context:{icon:function(a){return a.cluster?
c.Util.getImgUrl("imgcluster.png"):a.attributes.icon},label:function(a){var b=a.layer._M.layerDescription.featureInfo;return a.cluster?a.cluster.length:b&&b.label&&b.label.value?b.label.value.replace(/\$+([^\$])+\$/g,function(b){b=b.replace(/[\$\$]/g,"");return c.Map.Util.Feature.getValue(a,b,a.attributes[b])}):""},fontSize:function(a){return(a=a.layer._M.layerDescription.featureInfo)&&a.label?a.label.size||10:20},fontColor:function(a){return(a=a.layer._M.layerDescription.featureInfo)&&a.label?a.label.color||
"#000":"#fff"},color:function(a){return a.cluster?"#666":a.attributes.color||a.layer._M.layerDescription.color||"darkgray"},scaledSize:function(a){if(a.cluster){if(a.attributes[d.filterOn]){for(var b,c,e,f=0,n=a.cluster.length;f<n;f++)b=a.cluster[f].attributes[d.filterOn],b>c&&(c=b,e=f);return 5*a.cluster[e].attributes[d.filterOn]}return 15+Math.min(2*a.cluster.length,40)}return a.attributes[d.filterOn]?5*a.attributes[d.filterOn]:15}}});return new OpenLayers.StyleMap({"default":a,select:{strokeColor:"#ffff00",
fillOpacity:0.9>=e?e+0.1:e-0.1}})}}})(window.M);
(function(c){c.Map.SearchContext=function(e,a,b){b=b||{};this.autoSearch=c.Util.getPropertyValue(b,"autoSearch",!1);this.connector=a;this.layer=e;this.nextRecord=c.Util.getPropertyValue(b,"nextRecord",1);this.nextRecordAlias=b.nextRecordAlias||"nextRecord";this.numRecordsPerPage=c.Util.getPropertyValue(b,"numRecordsPerPage",20);this.numRecordsPerPageAlias=b.numRecordsPerPageAlias||"numRecordsPerPage";this.totalResults=0;this.callback=b.callback;this.scope=b.scope;this.useGeo=!0;this.items=[];this.isDefined=
function(a){for(var b=0,c=this.items.length;b<c;b++){var e=this.items[b];if(a.id===e.id){if(void 0!==a.value)return!0;if(e.son&&a.son&&0<a.son.length)for(var j=0,k=e.son.length;j<k;j++)if(a.son[0].id===e.son[j].id)return!0}}return!1};this.add=function(a){for(var b=0,c=this.items.length;b<c;b++){var e=this.items[b];if(a.id===e.id){if(void 0!==a.value)e.value=a.value,e.title=a.title;else{b=0;for(c=e.son.length;b<c;b++)if(a.son[0].id===e.son[b].id)return e.son[b].value=a.son[0].value,e.son[b].title=
a.son[0].title,this.autoSearch&&"bbox"!==a.id&&this.search(),!0;e.son.push(a.son[0])}this.autoSearch&&"bbox"!==a.id&&this.search();return!0}}this.items.push(a);this.autoSearch&&"bbox"!==a.id&&this.search();return!0};this.clear=function(a){this.items=[];this.setGeo(this.useGeo);c.timeLine&&a&&this.setTime(c.timeLine.getInterval())};this.getSerializedParams=function(){for(var a=this.numRecordsPerPageAlias+"="+this.numRecordsPerPage,b=0,c=this.items.length;b<c;b++)if(a+="&"+encodeURIComponent(this.items[b].id)+
"=",void 0!==this.items[b].value)a+=encodeURIComponent(this.items[b].value);else for(var e=0,j=this.items[b].son.length;e<j;e++)0<e&&(a+="|"),a+=encodeURIComponent(this.items[b].son[e].value);return a};this.getValue=function(a){for(var b=0,c=this.items.length;b<c;b++)if(this.items[b].id===a)return this.items[b].value;return null};this.next=function(){var a=this.nextRecord+this.numRecordsPerPage;return a>this.totalResults?!1:this.search({nextRecord:a})};this.previous=function(){var a=this.nextRecord-
this.numRecordsPerPage;return 0>a?!1:this.search({nextRecord:a})};this.remove=function(a,b,c){var e,j,k,m;e=0;for(k=this.items.length;e<k;e++)if(null===b){if(a===this.items[e].id)return this.items.splice(e,1),c||this.autoSearch&&"bbox"!==b&&this.search(),!0}else if(b===this.items[e].id){j=0;for(m=this.items[e].son.length;j<m;j++)if(a===this.items[e].son[j].id)return this.items[e].son.splice(j,1),0===this.items[e].son.length&&this.items.splice(e,1),c||this.autoSearch&&"bbox"!==b&&this.search(),!0}return!1};
this.search=function(a){var b,e,h,j="",k=this.layer,m=this,a=a||{};e=a.nextRecord||1;h=$.isFunction(a.callback)?a.callback:null;if(k._M&&k._M.layerDescription.extras)for(b in k._M.layerDescription.extras)j+="&"+b+"="+k._M.layerDescription.extras[b];c.Util.ajax({url:c.Util.proxify(this.connector.searchUrl+this.getSerializedParams()+"&"+m.nextRecordAlias+"="+e+j),async:!0,dataType:"json",success:function(a){var b,d,f=c.Plugins.LayersManager;a?a.error?c.Util.message(k.name+" : "+a.error.message,-1):
(1===e&&k.destroyFeatures(),b=(new OpenLayers.Format.GeoJSON({internalProjection:c.Map.map.getProjectionObject(),externalProjection:c.Map.pc})).read(a),d=b.length,!b||0===d?(c.Util.message(c.Util._(k.name)+" : "+c.Util._("No result")),k._M.clusterized&&$.isFunction(k.strategies[0].recluster)&&(k.strategies[0].clearCache(),k.strategies[0].recluster())):(k._M.clusterized?(b=c.Map.Util.getFeatures(k).concat(b),k.addFeatures(b),$.isFunction(k.strategies[0].recluster)&&k.strategies[0].recluster()):k.addFeatures(b),
b=k._M.layerDescription.onSearch||{},b.zoom?c.Map.zoomTo(k.getDataExtent(),!1):c.Map.Util.zoomOn(k),$.isFunction(b.callback)&&b.callback(k),f&&f._o&&f._o.show(f._o.get(k._M.MID)),h&&h(m.scope,k)),d>m.numRecordsPerPage&&(m.numRecordsPerPage=d),k._M.searchContext.nextRecord=e,a=a.hasOwnProperty("properties")?a.properties:a,k._M.searchContext.totalResults=a.hasOwnProperty("totalResults")?a.totalResults:d,c.Map.events.trigger("layersend",{action:1===e?"features":"featureskeep",layer:k}),m.callback&&m.callback(m.scope,
k)):(1===e&&k.destroyFeatures(),c.Map.events.trigger("layersend",{action:"features",layer:k}),c.Util.message(k.name+" : "+c.Util._("No resut")))}},{title:c.Util._("Searching")+" : "+c.Util._(this.layer.name),cancel:!0});return!0};this.setGeo=function(a){this.useGeo=a;this.setBBOX(this.useGeo?c.Map.map.getExtent():null);this.autoSearch&&this.search()};this.setBBOX=function(a){a?(a=c.Map.Util.p2d(a.clone()),a={id:"bbox",title:c.Util._("Search Area"),son:[{id:"geometry",title:"geometry",value:c.Map.Util.convert({input:a,
format:"EXTENT",precision:5,limit:!0})}]},this.add(a)):this.remove("geometry","bbox")};this.setFilter=function(a,b){for(var c=0,e=this.connector.filters.length;c<e;c++)if(this.connector.filters[c].id===a){"text"===this.connector.filters[c].type&&this.add({id:this.connector.filters[c].id,title:this.connector.filters[c].title,operator:this.connector.filters[c].operator,value:b});break}};this.setTime=function(a){var b,e;b=this.connector.startDateAlias;e=this.connector.completionDateAlias;a?(b&&this.add({id:b,
title:c.Util._("Date"),value:a[0]}),e&&this.add({id:e,title:c.Util._("Date"),value:a[1]})):(this.remove(b,null),this.remove(e,null))};this.setSearchTerms=function(a){var b=this.connector.searchKeyAlias?this.connector.searchKeyAlias:"q";a?this.add({id:b,title:c.Util._("searchTerms"),value:a}):this.remove(b,null)};return this}})(window.M);
(function(c,e){e.layerTypes.Atom={clusterized:!0,icon:"vector.png",isFile:!0,hasStyleMap:!0,selectable:!0,add:function(a,b){var d,f=this;a.title=c.Util.getTitle(a);b._M.clusterized&&!b.hasOwnProperty("strategies")&&(b.strategies=[new OpenLayers.Strategy.Cluster(new OpenLayers.Strategy.Cluster(e.clusterOpts))]);d=new OpenLayers.Layer.Vector(a.title,b);a.hasOwnProperty("data")?f.load(a.data,a,d)||c.Map.removeLayer(d,!1):(d._M.isLoaded=!1,d.events.register("featuresadded",d,function(){e.events.trigger("layersend",
{action:"features",layer:d})}),$.ajax({url:c.Util.proxify(c.Util.getAbsoluteUrl(a.url)),layer:d,async:!0,success:function(b){f.load(b,a,this.layer)||c.Map.removeLayer(this.layer,!1)}}));return d},load:function(a,b,d){var f;try{f="EPSG:3857"===b.srs||"EPSG:900913"===b.srs?(new OpenLayers.Format.Atom).read(a):(new OpenLayers.Format.Atom({internalProjection:e.map.getProjectionObject(),externalProjection:e.pc})).read(a)}catch(g){return c.Util.message(d.name+" : "+c.Util._("Error"),-1),!1}if(f){if(0===
f.length)return c.Util.message(c.Util._(d.name)+" : "+c.Util._("No result")),!1;c.Util.message(c.Util._("Added")+" : "+c.Util._(d.name));d._M.isLoaded=!0;d.addFeatures(f);e.Util.zoomOn(d)}return!0}}})(window.M,window.M.Map);
(function(c,e){e.layerTypes.Bing={isRaster:!0,add:function(a,b){$.extend(b,{isBaseLayer:!0,name:c.Util.getTitle(a),key:a.key,type:a.bingType,transitionEffect:"resize"});var d=new OpenLayers.Layer.Bing(b);d.projection=new OpenLayers.Projection("EPSG:3857");return d},getMID:function(a){return a.MID||c.Util.crc32(a.type+(a.bingType||""))}}})(window.M,window.M.Map);
(function(c,e){e.layerTypes.Generic={icon:"map.png",add:function(a,b){a.title=c.Util.getTitle(a);if(!a.layer)return new OpenLayers.Layer.Vector(a.title,b);a.layer._M=b._M;return a.layer}}})(window.M,window.M.Map);
(function(c,e){e.layerTypes.GeoJSON={clusterized:!0,icon:"vector.png",isFile:!0,hasStyleMap:!0,selectable:!0,add:function(a,b,d){var f;a.title=c.Util.getTitle(a);b._M.clusterized&&!b.hasOwnProperty("strategies")&&(b.strategies=[new OpenLayers.Strategy.Cluster(e.clusterOpts)]);f=new OpenLayers.Layer.Vector(a.title,b);f.events.register("featuresadded",f,function(){e.events.trigger("layersend",{action:"features",layer:f})});a.hasOwnProperty("data")?(f.destroyFeatures(),this.load({data:a.data,layerDescription:a,
layer:f,zoomOnNew:a.zoomOnNew})||(f._M.isLoaded=!0,e.events.trigger("layersend",{action:"features",layer:f}))):a.url&&(f._M.isLoaded=!1,this.refresh(f,d));return f},load:function(a){var b,d,a=a||{};if(!a.data||!a.data.features||a.data.error)return c.Util.message(a.layer.name+" : "+(a.data?a.data.error.message:"Error"),-1),null;b=a.data.features.length;d=a.layer._M.pagination||{};if(0===b)return c.Util.message(c.Util._(a.layer.name)+" : "+c.Util._("No result")),null;a.layer._M.isLoaded=!0;d.numRecordsPerPage&&
d.nextRecord&&(b>d.numRecordsPerPage.value&&(d.numRecordsPerPage.value=b),d.nextRecord.value+=b,b=a.data.hasOwnProperty("properties")?a.data.properties:a.data,d.totalResults=b.hasOwnProperty("totalResults")&&b.totalResults?b.totalResults:null);d=a.layerDescription&&("EPSG:3857"===a.layerDescription.srs||"EPSG:900913"===a.layerDescription.srs)?(new OpenLayers.Format.GeoJSON).read(a.data):(new OpenLayers.Format.GeoJSON({internalProjection:e.map.getProjectionObject(),externalProjection:e.pc})).read(a.data);
if(a.layer._M.clusterized){var f=e.Util.getFeatures(a.layer),g=f.length,h=0;for(b=d.length;h<b;h++)f[g+h]=d[h];a.layer.destroyFeatures();a.layer.addFeatures(f)}else a.layer.addFeatures(d);a.zoomOnNew?e.Util.Feature.zoomOn(d,"always"===a.zoomOnNew?!1:!0):e.Util.zoomOn(a.layer);return d},next:function(a){var b=this,d=a._M.pagination,e=a._M.layerDescription;if(!d||d.totalResults&&d.nextRecord.value>d.totalResults)return!1;c.Util.ajax({url:c.Util.proxify(c.Util.paginate(e.url,d)),layer:a,async:!0,dataType:"json",
success:function(a){b.load({data:a,layerDescription:e,layer:this.layer})}},{title:c.Util._("Retrieve features"),cancel:!0});return!0},refresh:function(a,b){var d,f,g=this;if(!a||!a._M)return!1;f=a._M.layerDescription;d=a._M.pagination||{};d.nextRecord&&(d.nextRecord.value=1);d=b?c.Util.getAbsoluteUrl(b+encodeURIComponent(f.url+c.Util.abc)):f.url;$.ajax({url:c.Util.proxify(c.Util.paginate(d,a._M.pagination)),layer:a,async:!0,dataType:"json",success:function(a){this.layer.destroyFeatures();g.load({data:a,
layerDescription:f,layer:this.layer,zoomOnNew:f.zoomOnNew})||(this.layer._M.isLoaded=!0,e.events.trigger("layersend",{action:"features",layer:this.layer}))}});return!0}}})(window.M,window.M.Map);
(function(c,e){e.layerTypes.Google={isRaster:!0,add:function(a,b){if("object"!==typeof google||void 0===google.maps)return null;if(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)){var d;d=navigator.userAgent.indexOf("Version");if(-1!==d&&6>parseFloat(navigator.userAgent.substring(d+8).split(" ")[0]))return null}a.googleType=c.Util.getPropertyValue(a,"googleType","roadmap");a.title=c.Util.getTitle(a);$.extend(b,{isBaseLayer:!0,numZoomLevels:c.Util.getPropertyValue(a,"numZoomLevels",
c.Map.map.getNumZoomLevels()),transitionEffect:"resize",type:a.googleType});d=new OpenLayers.Layer.Google(a.title,b);d.projection=new OpenLayers.Projection("EPSG:3857");return d},getMID:function(a){return a.MID||c.Util.crc32(a.type+(a.googleType||"roadmap"))}}})(window.M,window.M.Map);
(function(c,e){e.layerTypes.WMS={isRaster:!0,icon:"wms.png",mandatories:["layers"],add:function(a,b){var d,f;$.extend(a,this.getLayerDescriptionFromUrl(a.url));a.url=c.Util.repareUrl(a.url);a.srs=c.Util.getPropertyValue(a,"srs",e.pc.projCode);d=a.version||"1.1.1";if(!(new e.LayerDescription(a,e)).isValid()||!a.hasOwnProperty("layers"))return a.initial||this.update(a),null;if(!b.projection||!a.isBaseLayer)if(f=c.Util.getPropertyValue(e.map,"projection",e.pc),a.srs!==f.projCode)return OpenLayers.Request.GET({url:c.Util.getAbsoluteUrl(c.Config.general.reprojectionServiceUrl)+
c.Util.abc+"&url="+encodeURIComponent(a.url)+"&layers="+encodeURIComponent(a.layers)+"&srs="+a.srs,callback:function(b){b=(new OpenLayers.Format.JSON).read(b.responseText);b.success?(a.projectedUrl=b.url,a.srs=e.map.getProjectionObject().projCode,e.addLayer(a)):c.Util.message(c.Util._("Error : cannot reproject this layer"))}}),null;$.extend(b._M,{selectable:!1,bounds:e.Util.getProjectedBounds(a.bbox||{bounds:"-170,-80,170,80",srs:"EPSG:4326"}),allowChangeOpacity:!0,legend:a.url+"service=WMS&version="+
d+"&format=image/png&request=GetLegendGraphic&layer="+a.layers,icon:this.getPreview(a)});$.extend(b,{buffer:0,wrapDateLine:!0,isBaseLayer:c.Util.getPropertyValue(a,"isBaseLayer",!1),attribution:a.attribution||null});a.time&&a.time.hasOwnProperty("default")&&(b.time=a.time["default"]);a.title=c.Util.getTitle(a);var g=new OpenLayers.Layer.WMS(a.title,c.Util.getPropertyValue(a,"projectedUrl",a.url),{layers:a.layers,format:"image/png",transitionEffect:"resize",transparent:"true",SLD:a.SLD,version:d},
b);a.hasOwnProperty("time")&&(g._M.setTime=function(a){a=$.isArray(a)?a[0]+(""!==a[1]?"/"+a[1]:""):"";this.layerDescription.time&&(this.layerDescription.time=this.layerDescription.time||{},this.layerDescription.time.value=a,g.mergeNewParams({time:a}))});return g},getLayerDescriptionFromUrl:function(a){var b={url:a};if(!a)return b;var d=c.Util.extractKVP(a,!0);if(!d.request||"getmap"!==d.request.toLowerCase())return b;$.extend(b,{url:c.Util.extractBaseUrl(a,"layers format transparent transitioneffect styles version request styles srs crs bbox width height".split(" ")),
preview:c.Util.extractBaseUrl(a,["width","height"])+"width=125&height=125",layers:d.layers,version:d.version,bbox:{bounds:d.bbox,srs:d.srs,crs:d.crs},srs:d.srs||d.crs});return b},update:function(a,b){var d,f,g,h,j=e.layerTypes.WMS,k=!b||!$.isFunction(b)?!1:!0;e.predefined.items.WMS=e.predefined.items.WMS||[];h=e.predefined.items.WMS;d=0;for(f=h.length;d<f;d++)if(g=h[d],g.url===a.url&&void 0!==g.capabilities)return a.capabilities=g.capabilities,k&&b(j.getLayerDescriptions(a)),!0;c.Util.ajax({url:c.Util.proxify(c.Util.repareUrl(a.url+
"request=GetCapabilities&service=WMS&version=1.1.1"),"XML"),async:!0,success:function(d,f,p){a.capabilities=c.Util.getCapabilities(p,new OpenLayers.Format.WMSCapabilities);a.title||(a.title=a.capabilities.service?a.capabilities.service.title:c.Util.getTitle(a));p=!1;d=0;for(f=h.length;d<f;d++)if(g=h[d],g.url===a.url&&void 0===g.layers){g.capabilities=a.capabilities;p=!0;break}p||e.predefined.add({type:"WMS",title:a.title,url:a.url,capabilities:a.capabilities});k&&b(j.getLayerDescriptions(a))},error:function(){c.Util.message(c.Util._("Error reading Capabilities file"))}},
{title:c.Util._("WMS")+" : "+c.Util._("Get capabilities"),cancel:!0});return!0},getLayerDescriptions:function(a){var b=[],d;if(!a||"object"!==typeof a)return b;d=a.capabilities;if(!d||!d.capability)b={type:"error",error:{message:"Error performing GetCapabilities operation"}};else for(var a=c.Util.repareUrl(a.url),f,g,h=d.capability.nestedLayers&&d.capability.nestedLayers[0]?d.capability.nestedLayers[0].title:null,j=0,k=d.capability.layers.length;j<k;j++){g=d.capability.layers[j];f={type:"WMS",title:g.title,
ptitle:h,url:a,layers:g.name,preview:this.getPreview({url:a,version:d.version,bbox:{bounds:g.llbbox,srs:"EPSG:4326"},layers:g.name}),version:d.version,bbox:{bounds:"-170,-80,170,80",srs:"EPSG:4326"}};g.llbbox&&4===g.llbbox.length&&(f.bbox.bounds=g.llbbox[0]+","+g.llbbox[1]+","+g.llbbox[2]+","+g.llbbox[3]);f.queryable=g.queryable?!0:!1;g.dimensions&&g.dimensions.time&&(f.time={"default":g.dimensions.time["default"],values:g.dimensions.time.values||[]});for(var m in g.srs)if(m===e.map.getProjectionObject().projCode)break;
m!==e.map.getProjectionObject().projCode&&(m=e.pc);f.srs=m;b.push(f)}return b},getPreview:function(a){var b,d,e,a=a||{};if(a.preview)return a.preview;d=a.version||"1.1.1";(e=c.Map.Util.getGeoBounds(a.bbox))||(e=new OpenLayers.Bounds(-180,-90,180,90));b=c.Util.repareUrl(a.url)+"WIDTH=150&HEIGHT=75&STYLES=&FORMAT=image/png&TRANSPARENT=false&SERVICE=WMS&REQUEST=GetMap&VERSION="+d;b="1.3.0"===d?b+("&CRS=EPSG:4326&BBOX="+e.bottom+","+e.left+","+e.top+","+e.right):b+("&SRS=EPSG:4326&BBOX="+e.left+","+e.bottom+
","+e.right+","+e.top);return b+"&LAYERS="+a.layers},getFeatureInfo:function(a,b){if(!a)return[];var b=b||{},d,f,g,h,j=[],k=e.map.getPixelFromLonLat(a);for(d=e.map.layers.length;d--;)if(f=e.map.layers[d],f._M&&(g=f._M.layerDescription)&&"WMS"===g.type&&g.queryable){g.version=g.version||"1.1.1";h=c.Util.repareUrl(g.url);h+="SERVICE=WMS";h+="&VERSION="+g.version;h+="&REQUEST=GetFeatureInfo";h+="&EXCEPTIONS=application/vnd.ogc.se_xml";h+="&X="+k.x;h+="&Y="+k.y;h+="&INFO_FORMAT="+(b.responseFormat?b.responseFormat:
"text/plain");h+="&QUERY_LAYERS="+g.layers;h+="&LAYERS="+g.layers;h+="&WIDTH="+e.map.size.w;h+="&HEIGHT="+e.map.size.h;if(g.projectedUrl){var m=e.map.p2d(map.getExtent().clone());h+="&BBOX="+m.toBBOX();h+="&SRS="+e.pc.projCode}else h+="&BBOX="+e.map.getExtent().toBBOX(),h+="&SRS="+g.srs;f={identifier:g.layers,name:f.name};j.push(f);(function(a,d){$.ajax({url:c.Util.proxify(d),async:!0,dataType:"text",success:function(c){"function"===typeof b.callback&&b.callback(a.identifier,c)},error:function(){"function"===
typeof b.callback&&b.callback(a.identifier,null)}})})(f,h)}return j},getMID:function(a){return a.MID||c.Util.crc32(a.type+(c.Util.repareUrl(a.url)||"")+(a.layers||""))}}})(window.M,window.M.Map);
(function(c,e){e.layerTypes.WMTS={isRaster:!0,icon:"wms.png",mandatories:["layer","matrixSet"],add:function(a,b){var d,e=a.matrixLength||22,g=Array(e);a.url=c.Util.repareUrl(a.url);if(!a.matrixIds)for(d=0;d<=e;++d)g[d]=(a.prefixMatrix?a.prefixMatrix:"")+d;$.extend(b,{name:a.title,url:a.url,layer:a.layer,matrixSet:a.matrixSet,matrixIds:a.matrixIds?a.matrixIds:g,maxZoomLevel:e,format:a.format||"image/png",style:a.style||"normal",version:"1.0.0",wrapDateLine:!0,isBaseLayer:c.Util.getPropertyValue(a,
"isBaseLayer",!1),attribution:a.attribution||null});a.time&&a.time.hasOwnProperty("default")&&(b.time=a.time["default"]);var h=new OpenLayers.Layer.WMTS(b);a.hasOwnProperty("time")&&(h._M.setTime=function(a){a=$.isArray(a)?a[0]:"";a=a.split("T")[0];this.layerDescription.time&&(this.layerDescription.time=this.layerDescription.time||{},this.layerDescription.time.value=a,h.mergeNewParams({TIME:a}))});return h},getMID:function(a){return a.MID||c.Util.crc32(a.type+(c.Util.repareUrl(a.url)||"")+(a.layer||
"")+(a.matrixSet||""))}}})(window.M,window.M.Map);
(function(c,e){e.layerTypes.XYZ={isRaster:!0,add:function(a,b){$.extend(b,{numZoomLevels:c.Util.getPropertyValue(a,"numZoomLevels",c.Map.map.getNumZoomLevels()),sphericalMercator:!0,wrapDateLine:!0,transitionEffect:"resize",buffer:0,isBaseLayer:c.Util.getPropertyValue(a,"isBaseLayer",!0)});b._M.selectable=!1;b._M.allowChangeOpacity=!0;var d=new OpenLayers.Layer.XYZ(a.title,a.url,b);d.projection=new OpenLayers.Projection("EPSG:3857");return d},getMID:function(a){if(a.MID)return a.MID;var b=a.url;"object"===
typeof a.url&&(b=a.url.toString());return c.Util.crc32(a.type+(b||""))}}})(window.M,window.M.Map);
(function(c){c.Plugins.Distance=function(){if(c.Plugins.Distance._o)return c.Plugins.Distance._o;this.result={title:"",elevations:[],plots:null};this.init=function(e){var a=this;a.options=e||{};$.extend(a.options,{elevationServiceUrl:c.Util.getPropertyValue(e,"elevationServiceUrl","http://maps.google.com/maps/api/elevation/json?sensor=false&"),samples:c.Util.getPropertyValue(e,"samples",30)});a.uid=c.Util.getId();e=new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{id:"__CONTROL_MEASURE__",persist:!0,
handlerOptions:{layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style("default",{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:6,graphicName:"circle",fillColor:"gray",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"white"},Line:{pointRadius:6,strokeWidth:3,strokeOpacity:1,strokeColor:"#FFFFFF",strokeDashstyle:"dash"}}})]})})}},eventListeners:{measure:function(b){var d=b.units,e=b.measure,g="",g=1===b.order?g+(c.Util._("Distance")+" : "+e.toFixed(3)+" "+
d):g+(c.Util._("Area")+" : "+e.toFixed(3)+" "+d+"<sup>2</sup>");a.result.title=g;a.result.elevations=[];a.result.plots=null;a.display(b.geometry.getVertices());c.Map.resetControl(this)}}});a.layer=new OpenLayers.Layer.Vector("__LAYER_DISTANCE__",{projection:c.Map.pc,displayInLayerSwitcher:!1,styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style("default",{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:"${size}",graphicName:"circle",fillColor:"${color}",fillOpacity:1,strokeWidth:1,
strokeOpacity:1,strokeColor:"white",label:"${label}",fontColor:"white",fontSize:"12px",labelXOffset:"10",labelYOffset:"10",labelAlign:"rm"}}})]})})});c.Map.addLayer({type:"Generic",title:a.layer.name,unremovable:!0,MLayer:!0,layer:a.layer});c.Map.map.addControl(e);c.menu&&c.menu.add([{id:c.Util.getId(),ic:"distance.png",ti:"Measure distance",cb:function(){c.Map.Util.getControlById("__CONTROL_MEASURE__").activate()}}]);c.Map.events.register("layersend",a,function(a,d,e){c.Map.Util.setLayerOnTop(e.layer)});
c.Map.events.register("resizeend",a,function(a){a.refreshElevation()});return this};this.display=function(e){if(this.options.elevationServiceUrl&&$.isFunction($.jqplot)){var a,b,d=!0,f="",g=null,h=Number.MAX_VALUE,j=Number.MIN_VALUE,k=Number.MAX_VALUE,m=Number.MIN_VALUE,n=this;a=0;for(b=e.length;a<b;a++)g=c.Map.Util.p2d(e[a]),d||(f+="|"),d=!1,g.x<h&&(h=g.x),g.x>j&&(j=g.x),g.y<k&&(k=g.y),g.y>m&&(m=g.y),f+=g.y+","+g.x;c.Util.ajax({url:c.Util.proxify(c.Util.repareUrl(c.Util.getAbsoluteUrl(this.options.elevationServiceUrl))+
"path="+f+"&samples="+n.options.samples),async:!0,dataType:"json",success:function(a){var b,d,e,f,g=n.layer,h=[];c.Map.Util.setVisibility(g,!0);g.destroyFeatures();if(a&&0<a.results.length){d=a.results.length;for(b=1;b<=d;b++)f=a.results[b-1],e=c.Map.Util.d2p(new OpenLayers.LonLat(parseFloat(f.location.lng),parseFloat(f.location.lat))),e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.lon,e.lat),{label:1===b||0===b%5?b:"",size:1===b||b===n.options.samples?6:4,color:1===b?"green":b===
n.options.samples?"red":0===b%5?"alt":"gray"}),g.addFeatures(e),h[b-1]=[b,parseFloat(f.elevation)],n.result.elevations.push({id:b,lat:f.location.lat,lng:f.location.lng,elevation:f.elevation});n.panelItem||(n.panelItem=c.southPanel.add({id:n.uid,title:"Elevation",onclose:function(){n.result.plots=[];c.Map.Util.setVisibility(n.layer,!1);n.panelItem=null},onshow:function(){c.Map.Util.setVisibility(n.layer,!0)}}),n.$e=n.panelItem.$content);n.result.plots=[h];n.fresh=!0;n.showElevation()}else c.Util.message(n.result.title)},
error:function(){c.Util.message(n.result.title)}},{title:c.Util._("Retrieve elevation data..."),cancel:!0})}else c.Util.message(this.result.title)};this.showElevation=function(){this.fresh&&c.southPanel.show(this.panelItem);this.fresh=!1;this.refreshElevation()};this.refreshElevation=function(){this.result.plots&&0!==this.result.plots.length&&(this.$e.empty(),$.jqplot(this.$e.attr("id"),this.result.plots,{axes:{xaxis:{min:1,max:this.samples,label:this.result.title,tickOptions:{formatString:"%d"}},
yaxis:{label:c.Util._("Elevation (m)"),labelRenderer:$.jqplot.CanvasAxisLabelRenderer}},cursor:{show:!0,showTooltip:!0,tooltipFormatString:"%d: %.1 m",tooltipLocation:"nw"},seriesDefaults:{fill:!0,fillToZero:!0,shadow:!1,color:"#000",fillColor:"#000"},negativeSeriesColors:["#555"]}))};c.Plugins.Distance._o=this;return this}})(window.M);
(function(c){c.Plugins.Navigation=function(){if(c.Plugins.Navigation._o)return c.Plugins.Navigation._o;this.init=function(e){var a=this;a.options=e||{};$.extend(a.options,{home:c.Util.getPropertyValue(a.options,"home",{lon:0,lat:40,zoom:2}),zoomin:c.Util.getPropertyValue(a.options,"zoomin",!0),zoomout:c.Util.getPropertyValue(a.options,"zoomout",!0),position:c.Util.getPropertyValue(a.options,"position","nw"),orientation:c.Util.getPropertyValue(a.options,"orientation","v")});tb=new c.Toolbar({position:a.options.position,
orientation:a.options.orientation});a.options.zoomin&&tb.add({title:"+",tt:"Zoom",onoff:!1,onactivate:function(a,d){d.activate(!1);c.Map.map.setCenter(c.Map.map.getCenter(),c.Map.map.getZoom()+1)}});a.options.zoomout&&tb.add({title:"-",tt:"Zoom out",onoff:!1,onactivate:function(a,d){d.activate(!1);c.Map.map.setCenter(c.Map.map.getCenter(),Math.max(c.Map.map.getZoom()-1,c.Map.lowestZoomLevel))}});a.options.home&&tb.add({title:"&#8226;",tt:"Global view",onoff:!1,onactivate:function(b,d){d.activate(!1);
c.Map.map.restrictedExtent?c.Map.map.zoomToExtent(c.Map.map.restrictedExtent):c.Map.setCenter(c.Map.Util.d2p(new OpenLayers.LonLat(a.options.home.lon,a.options.home.lat)),a.options.home.zoom,!0)}});return this};c.Plugins.Navigation._o=this;return this}})(window.M);
